{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util'; // FIXME 公用？\n\nfunction dataStatistics(datas, statisticType) {\n  var dataNameMap = {};\n  zrUtil.each(datas, function (data) {\n    data.each(data.mapDimension('value'), function (value, idx) {\n      // Add prefix to avoid conflict with Object.prototype.\n      var mapKey = 'ec-' + data.getName(idx);\n      dataNameMap[mapKey] = dataNameMap[mapKey] || [];\n\n      if (!isNaN(value)) {\n        dataNameMap[mapKey].push(value);\n      }\n    });\n  });\n  return datas[0].map(datas[0].mapDimension('value'), function (value, idx) {\n    var mapKey = 'ec-' + datas[0].getName(idx);\n    var sum = 0;\n    var min = Infinity;\n    var max = -Infinity;\n    var len = dataNameMap[mapKey].length;\n\n    for (var i = 0; i < len; i++) {\n      min = Math.min(min, dataNameMap[mapKey][i]);\n      max = Math.max(max, dataNameMap[mapKey][i]);\n      sum += dataNameMap[mapKey][i];\n    }\n\n    var result;\n\n    if (statisticType === 'min') {\n      result = min;\n    } else if (statisticType === 'max') {\n      result = max;\n    } else if (statisticType === 'average') {\n      result = sum / len;\n    } else {\n      result = sum;\n    }\n\n    return len === 0 ? NaN : result;\n  });\n}\n\nexport default function mapDataStatistic(ecModel) {\n  var seriesGroups = {};\n  ecModel.eachSeriesByType('map', function (seriesModel) {\n    var hostGeoModel = seriesModel.getHostGeoModel();\n    var key = hostGeoModel ? 'o' + hostGeoModel.id : 'i' + seriesModel.getMapType();\n    (seriesGroups[key] = seriesGroups[key] || []).push(seriesModel);\n  });\n  zrUtil.each(seriesGroups, function (seriesList, key) {\n    var data = dataStatistics(zrUtil.map(seriesList, function (seriesModel) {\n      return seriesModel.getData();\n    }), seriesList[0].get('mapValueCalculation'));\n\n    for (var i = 0; i < seriesList.length; i++) {\n      seriesList[i].originalData = seriesList[i].getData();\n    } // FIXME Put where?\n\n\n    for (var i = 0; i < seriesList.length; i++) {\n      seriesList[i].seriesGroup = seriesList;\n      seriesList[i].needsDrawMap = i === 0 && !seriesList[i].getHostGeoModel();\n      seriesList[i].setData(data.cloneShallow());\n      seriesList[i].mainSeries = seriesList[0];\n    }\n  });\n}","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/echarts/lib/chart/map/mapDataStatistic.js"],"names":["zrUtil","dataStatistics","datas","statisticType","dataNameMap","each","data","mapDimension","value","idx","mapKey","getName","isNaN","push","map","sum","min","Infinity","max","len","length","i","Math","result","NaN","mapDataStatistic","ecModel","seriesGroups","eachSeriesByType","seriesModel","hostGeoModel","getHostGeoModel","key","id","getMapType","seriesList","getData","get","originalData","seriesGroup","needsDrawMap","setData","cloneShallow","mainSeries"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util'; // FIXME 公用？\n\nfunction dataStatistics(datas, statisticType) {\n  var dataNameMap = {};\n  zrUtil.each(datas, function (data) {\n    data.each(data.mapDimension('value'), function (value, idx) {\n      // Add prefix to avoid conflict with Object.prototype.\n      var mapKey = 'ec-' + data.getName(idx);\n      dataNameMap[mapKey] = dataNameMap[mapKey] || [];\n\n      if (!isNaN(value)) {\n        dataNameMap[mapKey].push(value);\n      }\n    });\n  });\n  return datas[0].map(datas[0].mapDimension('value'), function (value, idx) {\n    var mapKey = 'ec-' + datas[0].getName(idx);\n    var sum = 0;\n    var min = Infinity;\n    var max = -Infinity;\n    var len = dataNameMap[mapKey].length;\n\n    for (var i = 0; i < len; i++) {\n      min = Math.min(min, dataNameMap[mapKey][i]);\n      max = Math.max(max, dataNameMap[mapKey][i]);\n      sum += dataNameMap[mapKey][i];\n    }\n\n    var result;\n\n    if (statisticType === 'min') {\n      result = min;\n    } else if (statisticType === 'max') {\n      result = max;\n    } else if (statisticType === 'average') {\n      result = sum / len;\n    } else {\n      result = sum;\n    }\n\n    return len === 0 ? NaN : result;\n  });\n}\n\nexport default function mapDataStatistic(ecModel) {\n  var seriesGroups = {};\n  ecModel.eachSeriesByType('map', function (seriesModel) {\n    var hostGeoModel = seriesModel.getHostGeoModel();\n    var key = hostGeoModel ? 'o' + hostGeoModel.id : 'i' + seriesModel.getMapType();\n    (seriesGroups[key] = seriesGroups[key] || []).push(seriesModel);\n  });\n  zrUtil.each(seriesGroups, function (seriesList, key) {\n    var data = dataStatistics(zrUtil.map(seriesList, function (seriesModel) {\n      return seriesModel.getData();\n    }), seriesList[0].get('mapValueCalculation'));\n\n    for (var i = 0; i < seriesList.length; i++) {\n      seriesList[i].originalData = seriesList[i].getData();\n    } // FIXME Put where?\n\n\n    for (var i = 0; i < seriesList.length; i++) {\n      seriesList[i].seriesGroup = seriesList;\n      seriesList[i].needsDrawMap = i === 0 && !seriesList[i].getHostGeoModel();\n      seriesList[i].setData(data.cloneShallow());\n      seriesList[i].mainSeries = seriesList[0];\n    }\n  });\n}"]},"metadata":{},"sourceType":"module"}