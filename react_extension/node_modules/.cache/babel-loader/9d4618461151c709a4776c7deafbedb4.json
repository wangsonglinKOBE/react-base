{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util';\nimport * as layout from '../../util/layout';\nimport * as numberUtil from '../../util/number'; // (24*60*60*1000)\n\nvar PROXIMATE_ONE_DAY = 86400000;\n\nvar Calendar =\n/** @class */\nfunction () {\n  function Calendar(calendarModel, ecModel, api) {\n    this.type = 'calendar';\n    this.dimensions = Calendar.dimensions; // Required in createListFromData\n\n    this.getDimensionsInfo = Calendar.getDimensionsInfo;\n    this._model = calendarModel;\n  }\n\n  Calendar.getDimensionsInfo = function () {\n    return [{\n      name: 'time',\n      type: 'time'\n    }, 'value'];\n  };\n\n  Calendar.prototype.getRangeInfo = function () {\n    return this._rangeInfo;\n  };\n\n  Calendar.prototype.getModel = function () {\n    return this._model;\n  };\n\n  Calendar.prototype.getRect = function () {\n    return this._rect;\n  };\n\n  Calendar.prototype.getCellWidth = function () {\n    return this._sw;\n  };\n\n  Calendar.prototype.getCellHeight = function () {\n    return this._sh;\n  };\n\n  Calendar.prototype.getOrient = function () {\n    return this._orient;\n  };\n  /**\n   * getFirstDayOfWeek\n   *\n   * @example\n   *     0 : start at Sunday\n   *     1 : start at Monday\n   *\n   * @return {number}\n   */\n\n\n  Calendar.prototype.getFirstDayOfWeek = function () {\n    return this._firstDayOfWeek;\n  };\n  /**\n   * get date info\n   * }\n   */\n\n\n  Calendar.prototype.getDateInfo = function (date) {\n    date = numberUtil.parseDate(date);\n    var y = date.getFullYear();\n    var m = date.getMonth() + 1;\n    var mStr = m < 10 ? '0' + m : '' + m;\n    var d = date.getDate();\n    var dStr = d < 10 ? '0' + d : '' + d;\n    var day = date.getDay();\n    day = Math.abs((day + 7 - this.getFirstDayOfWeek()) % 7);\n    return {\n      y: y + '',\n      m: mStr,\n      d: dStr,\n      day: day,\n      time: date.getTime(),\n      formatedDate: y + '-' + mStr + '-' + dStr,\n      date: date\n    };\n  };\n\n  Calendar.prototype.getNextNDay = function (date, n) {\n    n = n || 0;\n\n    if (n === 0) {\n      return this.getDateInfo(date);\n    }\n\n    date = new Date(this.getDateInfo(date).time);\n    date.setDate(date.getDate() + n);\n    return this.getDateInfo(date);\n  };\n\n  Calendar.prototype.update = function (ecModel, api) {\n    this._firstDayOfWeek = +this._model.getModel('dayLabel').get('firstDay');\n    this._orient = this._model.get('orient');\n    this._lineWidth = this._model.getModel('itemStyle').getItemStyle().lineWidth || 0;\n    this._rangeInfo = this._getRangeInfo(this._initRangeOption());\n    var weeks = this._rangeInfo.weeks || 1;\n    var whNames = ['width', 'height'];\n\n    var cellSize = this._model.getCellSize().slice();\n\n    var layoutParams = this._model.getBoxLayoutParams();\n\n    var cellNumbers = this._orient === 'horizontal' ? [weeks, 7] : [7, weeks];\n    zrUtil.each([0, 1], function (idx) {\n      if (cellSizeSpecified(cellSize, idx)) {\n        layoutParams[whNames[idx]] = cellSize[idx] * cellNumbers[idx];\n      }\n    });\n    var whGlobal = {\n      width: api.getWidth(),\n      height: api.getHeight()\n    };\n    var calendarRect = this._rect = layout.getLayoutRect(layoutParams, whGlobal);\n    zrUtil.each([0, 1], function (idx) {\n      if (!cellSizeSpecified(cellSize, idx)) {\n        cellSize[idx] = calendarRect[whNames[idx]] / cellNumbers[idx];\n      }\n    });\n\n    function cellSizeSpecified(cellSize, idx) {\n      return cellSize[idx] != null && cellSize[idx] !== 'auto';\n    } // Has been calculated out number.\n\n\n    this._sw = cellSize[0];\n    this._sh = cellSize[1];\n  };\n  /**\n   * Convert a time data(time, value) item to (x, y) point.\n   */\n  // TODO Clamp of calendar is not same with cartesian coordinate systems.\n  // It will return NaN if data exceeds.\n\n\n  Calendar.prototype.dataToPoint = function (data, clamp) {\n    zrUtil.isArray(data) && (data = data[0]);\n    clamp == null && (clamp = true);\n    var dayInfo = this.getDateInfo(data);\n    var range = this._rangeInfo;\n    var date = dayInfo.formatedDate; // if not in range return [NaN, NaN]\n\n    if (clamp && !(dayInfo.time >= range.start.time && dayInfo.time < range.end.time + PROXIMATE_ONE_DAY)) {\n      return [NaN, NaN];\n    }\n\n    var week = dayInfo.day;\n\n    var nthWeek = this._getRangeInfo([range.start.time, date]).nthWeek;\n\n    if (this._orient === 'vertical') {\n      return [this._rect.x + week * this._sw + this._sw / 2, this._rect.y + nthWeek * this._sh + this._sh / 2];\n    }\n\n    return [this._rect.x + nthWeek * this._sw + this._sw / 2, this._rect.y + week * this._sh + this._sh / 2];\n  };\n  /**\n   * Convert a (x, y) point to time data\n   */\n\n\n  Calendar.prototype.pointToData = function (point) {\n    var date = this.pointToDate(point);\n    return date && date.time;\n  };\n  /**\n   * Convert a time date item to (x, y) four point.\n   */\n\n\n  Calendar.prototype.dataToRect = function (data, clamp) {\n    var point = this.dataToPoint(data, clamp);\n    return {\n      contentShape: {\n        x: point[0] - (this._sw - this._lineWidth) / 2,\n        y: point[1] - (this._sh - this._lineWidth) / 2,\n        width: this._sw - this._lineWidth,\n        height: this._sh - this._lineWidth\n      },\n      center: point,\n      tl: [point[0] - this._sw / 2, point[1] - this._sh / 2],\n      tr: [point[0] + this._sw / 2, point[1] - this._sh / 2],\n      br: [point[0] + this._sw / 2, point[1] + this._sh / 2],\n      bl: [point[0] - this._sw / 2, point[1] + this._sh / 2]\n    };\n  };\n  /**\n   * Convert a (x, y) point to time date\n   *\n   * @param  {Array} point point\n   * @return {Object}       date\n   */\n\n\n  Calendar.prototype.pointToDate = function (point) {\n    var nthX = Math.floor((point[0] - this._rect.x) / this._sw) + 1;\n    var nthY = Math.floor((point[1] - this._rect.y) / this._sh) + 1;\n    var range = this._rangeInfo.range;\n\n    if (this._orient === 'vertical') {\n      return this._getDateByWeeksAndDay(nthY, nthX - 1, range);\n    }\n\n    return this._getDateByWeeksAndDay(nthX, nthY - 1, range);\n  };\n\n  Calendar.prototype.convertToPixel = function (ecModel, finder, value) {\n    var coordSys = getCoordSys(finder);\n    return coordSys === this ? coordSys.dataToPoint(value) : null;\n  };\n\n  Calendar.prototype.convertFromPixel = function (ecModel, finder, pixel) {\n    var coordSys = getCoordSys(finder);\n    return coordSys === this ? coordSys.pointToData(pixel) : null;\n  };\n\n  Calendar.prototype.containPoint = function (point) {\n    console.warn('Not implemented.');\n    return false;\n  };\n  /**\n   * initRange\n   * Normalize to an [start, end] array\n   */\n\n\n  Calendar.prototype._initRangeOption = function () {\n    var range = this._model.get('range');\n\n    var normalizedRange; // Convert [1990] to 1990\n\n    if (zrUtil.isArray(range) && range.length === 1) {\n      range = range[0];\n    }\n\n    if (!zrUtil.isArray(range)) {\n      var rangeStr = range.toString(); // One year.\n\n      if (/^\\d{4}$/.test(rangeStr)) {\n        normalizedRange = [rangeStr + '-01-01', rangeStr + '-12-31'];\n      } // One month\n\n\n      if (/^\\d{4}[\\/|-]\\d{1,2}$/.test(rangeStr)) {\n        var start = this.getDateInfo(rangeStr);\n        var firstDay = start.date;\n        firstDay.setMonth(firstDay.getMonth() + 1);\n        var end = this.getNextNDay(firstDay, -1);\n        normalizedRange = [start.formatedDate, end.formatedDate];\n      } // One day\n\n\n      if (/^\\d{4}[\\/|-]\\d{1,2}[\\/|-]\\d{1,2}$/.test(rangeStr)) {\n        normalizedRange = [rangeStr, rangeStr];\n      }\n    } else {\n      normalizedRange = range;\n    }\n\n    if (!normalizedRange) {\n      if (process.env.NODE_ENV !== 'production') {\n        zrUtil.logError('Invalid date range.');\n      } // Not handling it.\n\n\n      return range;\n    }\n\n    var tmp = this._getRangeInfo(normalizedRange);\n\n    if (tmp.start.time > tmp.end.time) {\n      normalizedRange.reverse();\n    }\n\n    return normalizedRange;\n  };\n  /**\n   * range info\n   *\n   * @private\n   * @param  {Array} range range ['2017-01-01', '2017-07-08']\n   *  If range[0] > range[1], they will not be reversed.\n   * @return {Object}       obj\n   */\n\n\n  Calendar.prototype._getRangeInfo = function (range) {\n    var parsedRange = [this.getDateInfo(range[0]), this.getDateInfo(range[1])];\n    var reversed;\n\n    if (parsedRange[0].time > parsedRange[1].time) {\n      reversed = true;\n      parsedRange.reverse();\n    }\n\n    var allDay = Math.floor(parsedRange[1].time / PROXIMATE_ONE_DAY) - Math.floor(parsedRange[0].time / PROXIMATE_ONE_DAY) + 1; // Consider case1 (#11677 #10430):\n    // Set the system timezone as \"UK\", set the range to `['2016-07-01', '2016-12-31']`\n    // Consider case2:\n    // Firstly set system timezone as \"Time Zone: America/Toronto\",\n    // ```\n    // let first = new Date(1478412000000 - 3600 * 1000 * 2.5);\n    // let second = new Date(1478412000000);\n    // let allDays = Math.floor(second / ONE_DAY) - Math.floor(first / ONE_DAY) + 1;\n    // ```\n    // will get wrong result because of DST. So we should fix it.\n\n    var date = new Date(parsedRange[0].time);\n    var startDateNum = date.getDate();\n    var endDateNum = parsedRange[1].date.getDate();\n    date.setDate(startDateNum + allDay - 1); // The bias can not over a month, so just compare date.\n\n    var dateNum = date.getDate();\n\n    if (dateNum !== endDateNum) {\n      var sign = date.getTime() - parsedRange[1].time > 0 ? 1 : -1;\n\n      while ((dateNum = date.getDate()) !== endDateNum && (date.getTime() - parsedRange[1].time) * sign > 0) {\n        allDay -= sign;\n        date.setDate(dateNum - sign);\n      }\n    }\n\n    var weeks = Math.floor((allDay + parsedRange[0].day + 6) / 7);\n    var nthWeek = reversed ? -weeks + 1 : weeks - 1;\n    reversed && parsedRange.reverse();\n    return {\n      range: [parsedRange[0].formatedDate, parsedRange[1].formatedDate],\n      start: parsedRange[0],\n      end: parsedRange[1],\n      allDay: allDay,\n      weeks: weeks,\n      // From 0.\n      nthWeek: nthWeek,\n      fweek: parsedRange[0].day,\n      lweek: parsedRange[1].day\n    };\n  };\n  /**\n   * get date by nthWeeks and week day in range\n   *\n   * @private\n   * @param  {number} nthWeek the week\n   * @param  {number} day   the week day\n   * @param  {Array} range [d1, d2]\n   * @return {Object}\n   */\n\n\n  Calendar.prototype._getDateByWeeksAndDay = function (nthWeek, day, range) {\n    var rangeInfo = this._getRangeInfo(range);\n\n    if (nthWeek > rangeInfo.weeks || nthWeek === 0 && day < rangeInfo.fweek || nthWeek === rangeInfo.weeks && day > rangeInfo.lweek) {\n      return null;\n    }\n\n    var nthDay = (nthWeek - 1) * 7 - rangeInfo.fweek + day;\n    var date = new Date(rangeInfo.start.time);\n    date.setDate(+rangeInfo.start.d + nthDay);\n    return this.getDateInfo(date);\n  };\n\n  Calendar.create = function (ecModel, api) {\n    var calendarList = [];\n    ecModel.eachComponent('calendar', function (calendarModel) {\n      var calendar = new Calendar(calendarModel, ecModel, api);\n      calendarList.push(calendar);\n      calendarModel.coordinateSystem = calendar;\n    });\n    ecModel.eachSeries(function (calendarSeries) {\n      if (calendarSeries.get('coordinateSystem') === 'calendar') {\n        // Inject coordinate system\n        calendarSeries.coordinateSystem = calendarList[calendarSeries.get('calendarIndex') || 0];\n      }\n    });\n    return calendarList;\n  };\n\n  Calendar.dimensions = ['time', 'value'];\n  return Calendar;\n}();\n\nfunction getCoordSys(finder) {\n  var calendarModel = finder.calendarModel;\n  var seriesModel = finder.seriesModel;\n  var coordSys = calendarModel ? calendarModel.coordinateSystem : seriesModel ? seriesModel.coordinateSystem : null;\n  return coordSys;\n}\n\nexport default Calendar;","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/echarts/lib/coord/calendar/Calendar.js"],"names":["zrUtil","layout","numberUtil","PROXIMATE_ONE_DAY","Calendar","calendarModel","ecModel","api","type","dimensions","getDimensionsInfo","_model","name","prototype","getRangeInfo","_rangeInfo","getModel","getRect","_rect","getCellWidth","_sw","getCellHeight","_sh","getOrient","_orient","getFirstDayOfWeek","_firstDayOfWeek","getDateInfo","date","parseDate","y","getFullYear","m","getMonth","mStr","d","getDate","dStr","day","getDay","Math","abs","time","getTime","formatedDate","getNextNDay","n","Date","setDate","update","get","_lineWidth","getItemStyle","lineWidth","_getRangeInfo","_initRangeOption","weeks","whNames","cellSize","getCellSize","slice","layoutParams","getBoxLayoutParams","cellNumbers","each","idx","cellSizeSpecified","whGlobal","width","getWidth","height","getHeight","calendarRect","getLayoutRect","dataToPoint","data","clamp","isArray","dayInfo","range","start","end","NaN","week","nthWeek","x","pointToData","point","pointToDate","dataToRect","contentShape","center","tl","tr","br","bl","nthX","floor","nthY","_getDateByWeeksAndDay","convertToPixel","finder","value","coordSys","getCoordSys","convertFromPixel","pixel","containPoint","console","warn","normalizedRange","length","rangeStr","toString","test","firstDay","setMonth","process","env","NODE_ENV","logError","tmp","reverse","parsedRange","reversed","allDay","startDateNum","endDateNum","dateNum","sign","fweek","lweek","rangeInfo","nthDay","create","calendarList","eachComponent","calendar","push","coordinateSystem","eachSeries","calendarSeries","seriesModel"],"mappings":"AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,KAAKA,MAAZ,MAAwB,uBAAxB;AACA,OAAO,KAAKC,MAAZ,MAAwB,mBAAxB;AACA,OAAO,KAAKC,UAAZ,MAA4B,mBAA5B,C,CAAiD;;AAEjD,IAAIC,iBAAiB,GAAG,QAAxB;;AAEA,IAAIC,QAAQ;AACZ;AACA,YAAY;AACV,WAASA,QAAT,CAAkBC,aAAlB,EAAiCC,OAAjC,EAA0CC,GAA1C,EAA+C;AAC7C,SAAKC,IAAL,GAAY,UAAZ;AACA,SAAKC,UAAL,GAAkBL,QAAQ,CAACK,UAA3B,CAF6C,CAEN;;AAEvC,SAAKC,iBAAL,GAAyBN,QAAQ,CAACM,iBAAlC;AACA,SAAKC,MAAL,GAAcN,aAAd;AACD;;AAEDD,EAAAA,QAAQ,CAACM,iBAAT,GAA6B,YAAY;AACvC,WAAO,CAAC;AACNE,MAAAA,IAAI,EAAE,MADA;AAENJ,MAAAA,IAAI,EAAE;AAFA,KAAD,EAGJ,OAHI,CAAP;AAID,GALD;;AAOAJ,EAAAA,QAAQ,CAACS,SAAT,CAAmBC,YAAnB,GAAkC,YAAY;AAC5C,WAAO,KAAKC,UAAZ;AACD,GAFD;;AAIAX,EAAAA,QAAQ,CAACS,SAAT,CAAmBG,QAAnB,GAA8B,YAAY;AACxC,WAAO,KAAKL,MAAZ;AACD,GAFD;;AAIAP,EAAAA,QAAQ,CAACS,SAAT,CAAmBI,OAAnB,GAA6B,YAAY;AACvC,WAAO,KAAKC,KAAZ;AACD,GAFD;;AAIAd,EAAAA,QAAQ,CAACS,SAAT,CAAmBM,YAAnB,GAAkC,YAAY;AAC5C,WAAO,KAAKC,GAAZ;AACD,GAFD;;AAIAhB,EAAAA,QAAQ,CAACS,SAAT,CAAmBQ,aAAnB,GAAmC,YAAY;AAC7C,WAAO,KAAKC,GAAZ;AACD,GAFD;;AAIAlB,EAAAA,QAAQ,CAACS,SAAT,CAAmBU,SAAnB,GAA+B,YAAY;AACzC,WAAO,KAAKC,OAAZ;AACD,GAFD;AAGA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGEpB,EAAAA,QAAQ,CAACS,SAAT,CAAmBY,iBAAnB,GAAuC,YAAY;AACjD,WAAO,KAAKC,eAAZ;AACD,GAFD;AAGA;AACF;AACA;AACA;;;AAGEtB,EAAAA,QAAQ,CAACS,SAAT,CAAmBc,WAAnB,GAAiC,UAAUC,IAAV,EAAgB;AAC/CA,IAAAA,IAAI,GAAG1B,UAAU,CAAC2B,SAAX,CAAqBD,IAArB,CAAP;AACA,QAAIE,CAAC,GAAGF,IAAI,CAACG,WAAL,EAAR;AACA,QAAIC,CAAC,GAAGJ,IAAI,CAACK,QAAL,KAAkB,CAA1B;AACA,QAAIC,IAAI,GAAGF,CAAC,GAAG,EAAJ,GAAS,MAAMA,CAAf,GAAmB,KAAKA,CAAnC;AACA,QAAIG,CAAC,GAAGP,IAAI,CAACQ,OAAL,EAAR;AACA,QAAIC,IAAI,GAAGF,CAAC,GAAG,EAAJ,GAAS,MAAMA,CAAf,GAAmB,KAAKA,CAAnC;AACA,QAAIG,GAAG,GAAGV,IAAI,CAACW,MAAL,EAAV;AACAD,IAAAA,GAAG,GAAGE,IAAI,CAACC,GAAL,CAAS,CAACH,GAAG,GAAG,CAAN,GAAU,KAAKb,iBAAL,EAAX,IAAuC,CAAhD,CAAN;AACA,WAAO;AACLK,MAAAA,CAAC,EAAEA,CAAC,GAAG,EADF;AAELE,MAAAA,CAAC,EAAEE,IAFE;AAGLC,MAAAA,CAAC,EAAEE,IAHE;AAILC,MAAAA,GAAG,EAAEA,GAJA;AAKLI,MAAAA,IAAI,EAAEd,IAAI,CAACe,OAAL,EALD;AAMLC,MAAAA,YAAY,EAAEd,CAAC,GAAG,GAAJ,GAAUI,IAAV,GAAiB,GAAjB,GAAuBG,IANhC;AAOLT,MAAAA,IAAI,EAAEA;AAPD,KAAP;AASD,GAlBD;;AAoBAxB,EAAAA,QAAQ,CAACS,SAAT,CAAmBgC,WAAnB,GAAiC,UAAUjB,IAAV,EAAgBkB,CAAhB,EAAmB;AAClDA,IAAAA,CAAC,GAAGA,CAAC,IAAI,CAAT;;AAEA,QAAIA,CAAC,KAAK,CAAV,EAAa;AACX,aAAO,KAAKnB,WAAL,CAAiBC,IAAjB,CAAP;AACD;;AAEDA,IAAAA,IAAI,GAAG,IAAImB,IAAJ,CAAS,KAAKpB,WAAL,CAAiBC,IAAjB,EAAuBc,IAAhC,CAAP;AACAd,IAAAA,IAAI,CAACoB,OAAL,CAAapB,IAAI,CAACQ,OAAL,KAAiBU,CAA9B;AACA,WAAO,KAAKnB,WAAL,CAAiBC,IAAjB,CAAP;AACD,GAVD;;AAYAxB,EAAAA,QAAQ,CAACS,SAAT,CAAmBoC,MAAnB,GAA4B,UAAU3C,OAAV,EAAmBC,GAAnB,EAAwB;AAClD,SAAKmB,eAAL,GAAuB,CAAC,KAAKf,MAAL,CAAYK,QAAZ,CAAqB,UAArB,EAAiCkC,GAAjC,CAAqC,UAArC,CAAxB;AACA,SAAK1B,OAAL,GAAe,KAAKb,MAAL,CAAYuC,GAAZ,CAAgB,QAAhB,CAAf;AACA,SAAKC,UAAL,GAAkB,KAAKxC,MAAL,CAAYK,QAAZ,CAAqB,WAArB,EAAkCoC,YAAlC,GAAiDC,SAAjD,IAA8D,CAAhF;AACA,SAAKtC,UAAL,GAAkB,KAAKuC,aAAL,CAAmB,KAAKC,gBAAL,EAAnB,CAAlB;AACA,QAAIC,KAAK,GAAG,KAAKzC,UAAL,CAAgByC,KAAhB,IAAyB,CAArC;AACA,QAAIC,OAAO,GAAG,CAAC,OAAD,EAAU,QAAV,CAAd;;AAEA,QAAIC,QAAQ,GAAG,KAAK/C,MAAL,CAAYgD,WAAZ,GAA0BC,KAA1B,EAAf;;AAEA,QAAIC,YAAY,GAAG,KAAKlD,MAAL,CAAYmD,kBAAZ,EAAnB;;AAEA,QAAIC,WAAW,GAAG,KAAKvC,OAAL,KAAiB,YAAjB,GAAgC,CAACgC,KAAD,EAAQ,CAAR,CAAhC,GAA6C,CAAC,CAAD,EAAIA,KAAJ,CAA/D;AACAxD,IAAAA,MAAM,CAACgE,IAAP,CAAY,CAAC,CAAD,EAAI,CAAJ,CAAZ,EAAoB,UAAUC,GAAV,EAAe;AACjC,UAAIC,iBAAiB,CAACR,QAAD,EAAWO,GAAX,CAArB,EAAsC;AACpCJ,QAAAA,YAAY,CAACJ,OAAO,CAACQ,GAAD,CAAR,CAAZ,GAA6BP,QAAQ,CAACO,GAAD,CAAR,GAAgBF,WAAW,CAACE,GAAD,CAAxD;AACD;AACF,KAJD;AAKA,QAAIE,QAAQ,GAAG;AACbC,MAAAA,KAAK,EAAE7D,GAAG,CAAC8D,QAAJ,EADM;AAEbC,MAAAA,MAAM,EAAE/D,GAAG,CAACgE,SAAJ;AAFK,KAAf;AAIA,QAAIC,YAAY,GAAG,KAAKtD,KAAL,GAAajB,MAAM,CAACwE,aAAP,CAAqBZ,YAArB,EAAmCM,QAAnC,CAAhC;AACAnE,IAAAA,MAAM,CAACgE,IAAP,CAAY,CAAC,CAAD,EAAI,CAAJ,CAAZ,EAAoB,UAAUC,GAAV,EAAe;AACjC,UAAI,CAACC,iBAAiB,CAACR,QAAD,EAAWO,GAAX,CAAtB,EAAuC;AACrCP,QAAAA,QAAQ,CAACO,GAAD,CAAR,GAAgBO,YAAY,CAACf,OAAO,CAACQ,GAAD,CAAR,CAAZ,GAA6BF,WAAW,CAACE,GAAD,CAAxD;AACD;AACF,KAJD;;AAMA,aAASC,iBAAT,CAA2BR,QAA3B,EAAqCO,GAArC,EAA0C;AACxC,aAAOP,QAAQ,CAACO,GAAD,CAAR,IAAiB,IAAjB,IAAyBP,QAAQ,CAACO,GAAD,CAAR,KAAkB,MAAlD;AACD,KA/BiD,CA+BhD;;;AAGF,SAAK7C,GAAL,GAAWsC,QAAQ,CAAC,CAAD,CAAnB;AACA,SAAKpC,GAAL,GAAWoC,QAAQ,CAAC,CAAD,CAAnB;AACD,GApCD;AAqCA;AACF;AACA;AACE;AACA;;;AAGAtD,EAAAA,QAAQ,CAACS,SAAT,CAAmB6D,WAAnB,GAAiC,UAAUC,IAAV,EAAgBC,KAAhB,EAAuB;AACtD5E,IAAAA,MAAM,CAAC6E,OAAP,CAAeF,IAAf,MAAyBA,IAAI,GAAGA,IAAI,CAAC,CAAD,CAApC;AACAC,IAAAA,KAAK,IAAI,IAAT,KAAkBA,KAAK,GAAG,IAA1B;AACA,QAAIE,OAAO,GAAG,KAAKnD,WAAL,CAAiBgD,IAAjB,CAAd;AACA,QAAII,KAAK,GAAG,KAAKhE,UAAjB;AACA,QAAIa,IAAI,GAAGkD,OAAO,CAAClC,YAAnB,CALsD,CAKrB;;AAEjC,QAAIgC,KAAK,IAAI,EAAEE,OAAO,CAACpC,IAAR,IAAgBqC,KAAK,CAACC,KAAN,CAAYtC,IAA5B,IAAoCoC,OAAO,CAACpC,IAAR,GAAeqC,KAAK,CAACE,GAAN,CAAUvC,IAAV,GAAiBvC,iBAAtE,CAAb,EAAuG;AACrG,aAAO,CAAC+E,GAAD,EAAMA,GAAN,CAAP;AACD;;AAED,QAAIC,IAAI,GAAGL,OAAO,CAACxC,GAAnB;;AAEA,QAAI8C,OAAO,GAAG,KAAK9B,aAAL,CAAmB,CAACyB,KAAK,CAACC,KAAN,CAAYtC,IAAb,EAAmBd,IAAnB,CAAnB,EAA6CwD,OAA3D;;AAEA,QAAI,KAAK5D,OAAL,KAAiB,UAArB,EAAiC;AAC/B,aAAO,CAAC,KAAKN,KAAL,CAAWmE,CAAX,GAAeF,IAAI,GAAG,KAAK/D,GAA3B,GAAiC,KAAKA,GAAL,GAAW,CAA7C,EAAgD,KAAKF,KAAL,CAAWY,CAAX,GAAesD,OAAO,GAAG,KAAK9D,GAA9B,GAAoC,KAAKA,GAAL,GAAW,CAA/F,CAAP;AACD;;AAED,WAAO,CAAC,KAAKJ,KAAL,CAAWmE,CAAX,GAAeD,OAAO,GAAG,KAAKhE,GAA9B,GAAoC,KAAKA,GAAL,GAAW,CAAhD,EAAmD,KAAKF,KAAL,CAAWY,CAAX,GAAeqD,IAAI,GAAG,KAAK7D,GAA3B,GAAiC,KAAKA,GAAL,GAAW,CAA/F,CAAP;AACD,GApBD;AAqBA;AACF;AACA;;;AAGElB,EAAAA,QAAQ,CAACS,SAAT,CAAmByE,WAAnB,GAAiC,UAAUC,KAAV,EAAiB;AAChD,QAAI3D,IAAI,GAAG,KAAK4D,WAAL,CAAiBD,KAAjB,CAAX;AACA,WAAO3D,IAAI,IAAIA,IAAI,CAACc,IAApB;AACD,GAHD;AAIA;AACF;AACA;;;AAGEtC,EAAAA,QAAQ,CAACS,SAAT,CAAmB4E,UAAnB,GAAgC,UAAUd,IAAV,EAAgBC,KAAhB,EAAuB;AACrD,QAAIW,KAAK,GAAG,KAAKb,WAAL,CAAiBC,IAAjB,EAAuBC,KAAvB,CAAZ;AACA,WAAO;AACLc,MAAAA,YAAY,EAAE;AACZL,QAAAA,CAAC,EAAEE,KAAK,CAAC,CAAD,CAAL,GAAW,CAAC,KAAKnE,GAAL,GAAW,KAAK+B,UAAjB,IAA+B,CADjC;AAEZrB,QAAAA,CAAC,EAAEyD,KAAK,CAAC,CAAD,CAAL,GAAW,CAAC,KAAKjE,GAAL,GAAW,KAAK6B,UAAjB,IAA+B,CAFjC;AAGZiB,QAAAA,KAAK,EAAE,KAAKhD,GAAL,GAAW,KAAK+B,UAHX;AAIZmB,QAAAA,MAAM,EAAE,KAAKhD,GAAL,GAAW,KAAK6B;AAJZ,OADT;AAOLwC,MAAAA,MAAM,EAAEJ,KAPH;AAQLK,MAAAA,EAAE,EAAE,CAACL,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKnE,GAAL,GAAW,CAAvB,EAA0BmE,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKjE,GAAL,GAAW,CAAhD,CARC;AASLuE,MAAAA,EAAE,EAAE,CAACN,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKnE,GAAL,GAAW,CAAvB,EAA0BmE,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKjE,GAAL,GAAW,CAAhD,CATC;AAULwE,MAAAA,EAAE,EAAE,CAACP,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKnE,GAAL,GAAW,CAAvB,EAA0BmE,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKjE,GAAL,GAAW,CAAhD,CAVC;AAWLyE,MAAAA,EAAE,EAAE,CAACR,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKnE,GAAL,GAAW,CAAvB,EAA0BmE,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKjE,GAAL,GAAW,CAAhD;AAXC,KAAP;AAaD,GAfD;AAgBA;AACF;AACA;AACA;AACA;AACA;;;AAGElB,EAAAA,QAAQ,CAACS,SAAT,CAAmB2E,WAAnB,GAAiC,UAAUD,KAAV,EAAiB;AAChD,QAAIS,IAAI,GAAGxD,IAAI,CAACyD,KAAL,CAAW,CAACV,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKrE,KAAL,CAAWmE,CAAvB,IAA4B,KAAKjE,GAA5C,IAAmD,CAA9D;AACA,QAAI8E,IAAI,GAAG1D,IAAI,CAACyD,KAAL,CAAW,CAACV,KAAK,CAAC,CAAD,CAAL,GAAW,KAAKrE,KAAL,CAAWY,CAAvB,IAA4B,KAAKR,GAA5C,IAAmD,CAA9D;AACA,QAAIyD,KAAK,GAAG,KAAKhE,UAAL,CAAgBgE,KAA5B;;AAEA,QAAI,KAAKvD,OAAL,KAAiB,UAArB,EAAiC;AAC/B,aAAO,KAAK2E,qBAAL,CAA2BD,IAA3B,EAAiCF,IAAI,GAAG,CAAxC,EAA2CjB,KAA3C,CAAP;AACD;;AAED,WAAO,KAAKoB,qBAAL,CAA2BH,IAA3B,EAAiCE,IAAI,GAAG,CAAxC,EAA2CnB,KAA3C,CAAP;AACD,GAVD;;AAYA3E,EAAAA,QAAQ,CAACS,SAAT,CAAmBuF,cAAnB,GAAoC,UAAU9F,OAAV,EAAmB+F,MAAnB,EAA2BC,KAA3B,EAAkC;AACpE,QAAIC,QAAQ,GAAGC,WAAW,CAACH,MAAD,CAA1B;AACA,WAAOE,QAAQ,KAAK,IAAb,GAAoBA,QAAQ,CAAC7B,WAAT,CAAqB4B,KAArB,CAApB,GAAkD,IAAzD;AACD,GAHD;;AAKAlG,EAAAA,QAAQ,CAACS,SAAT,CAAmB4F,gBAAnB,GAAsC,UAAUnG,OAAV,EAAmB+F,MAAnB,EAA2BK,KAA3B,EAAkC;AACtE,QAAIH,QAAQ,GAAGC,WAAW,CAACH,MAAD,CAA1B;AACA,WAAOE,QAAQ,KAAK,IAAb,GAAoBA,QAAQ,CAACjB,WAAT,CAAqBoB,KAArB,CAApB,GAAkD,IAAzD;AACD,GAHD;;AAKAtG,EAAAA,QAAQ,CAACS,SAAT,CAAmB8F,YAAnB,GAAkC,UAAUpB,KAAV,EAAiB;AACjDqB,IAAAA,OAAO,CAACC,IAAR,CAAa,kBAAb;AACA,WAAO,KAAP;AACD,GAHD;AAIA;AACF;AACA;AACA;;;AAGEzG,EAAAA,QAAQ,CAACS,SAAT,CAAmB0C,gBAAnB,GAAsC,YAAY;AAChD,QAAIwB,KAAK,GAAG,KAAKpE,MAAL,CAAYuC,GAAZ,CAAgB,OAAhB,CAAZ;;AAEA,QAAI4D,eAAJ,CAHgD,CAG3B;;AAErB,QAAI9G,MAAM,CAAC6E,OAAP,CAAeE,KAAf,KAAyBA,KAAK,CAACgC,MAAN,KAAiB,CAA9C,EAAiD;AAC/ChC,MAAAA,KAAK,GAAGA,KAAK,CAAC,CAAD,CAAb;AACD;;AAED,QAAI,CAAC/E,MAAM,CAAC6E,OAAP,CAAeE,KAAf,CAAL,EAA4B;AAC1B,UAAIiC,QAAQ,GAAGjC,KAAK,CAACkC,QAAN,EAAf,CAD0B,CACO;;AAEjC,UAAI,UAAUC,IAAV,CAAeF,QAAf,CAAJ,EAA8B;AAC5BF,QAAAA,eAAe,GAAG,CAACE,QAAQ,GAAG,QAAZ,EAAsBA,QAAQ,GAAG,QAAjC,CAAlB;AACD,OALyB,CAKxB;;;AAGF,UAAI,uBAAuBE,IAAvB,CAA4BF,QAA5B,CAAJ,EAA2C;AACzC,YAAIhC,KAAK,GAAG,KAAKrD,WAAL,CAAiBqF,QAAjB,CAAZ;AACA,YAAIG,QAAQ,GAAGnC,KAAK,CAACpD,IAArB;AACAuF,QAAAA,QAAQ,CAACC,QAAT,CAAkBD,QAAQ,CAAClF,QAAT,KAAsB,CAAxC;AACA,YAAIgD,GAAG,GAAG,KAAKpC,WAAL,CAAiBsE,QAAjB,EAA2B,CAAC,CAA5B,CAAV;AACAL,QAAAA,eAAe,GAAG,CAAC9B,KAAK,CAACpC,YAAP,EAAqBqC,GAAG,CAACrC,YAAzB,CAAlB;AACD,OAdyB,CAcxB;;;AAGF,UAAI,oCAAoCsE,IAApC,CAAyCF,QAAzC,CAAJ,EAAwD;AACtDF,QAAAA,eAAe,GAAG,CAACE,QAAD,EAAWA,QAAX,CAAlB;AACD;AACF,KApBD,MAoBO;AACLF,MAAAA,eAAe,GAAG/B,KAAlB;AACD;;AAED,QAAI,CAAC+B,eAAL,EAAsB;AACpB,UAAIO,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzCvH,QAAAA,MAAM,CAACwH,QAAP,CAAgB,qBAAhB;AACD,OAHmB,CAGlB;;;AAGF,aAAOzC,KAAP;AACD;;AAED,QAAI0C,GAAG,GAAG,KAAKnE,aAAL,CAAmBwD,eAAnB,CAAV;;AAEA,QAAIW,GAAG,CAACzC,KAAJ,CAAUtC,IAAV,GAAiB+E,GAAG,CAACxC,GAAJ,CAAQvC,IAA7B,EAAmC;AACjCoE,MAAAA,eAAe,CAACY,OAAhB;AACD;;AAED,WAAOZ,eAAP;AACD,GAjDD;AAkDA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGE1G,EAAAA,QAAQ,CAACS,SAAT,CAAmByC,aAAnB,GAAmC,UAAUyB,KAAV,EAAiB;AAClD,QAAI4C,WAAW,GAAG,CAAC,KAAKhG,WAAL,CAAiBoD,KAAK,CAAC,CAAD,CAAtB,CAAD,EAA6B,KAAKpD,WAAL,CAAiBoD,KAAK,CAAC,CAAD,CAAtB,CAA7B,CAAlB;AACA,QAAI6C,QAAJ;;AAEA,QAAID,WAAW,CAAC,CAAD,CAAX,CAAejF,IAAf,GAAsBiF,WAAW,CAAC,CAAD,CAAX,CAAejF,IAAzC,EAA+C;AAC7CkF,MAAAA,QAAQ,GAAG,IAAX;AACAD,MAAAA,WAAW,CAACD,OAAZ;AACD;;AAED,QAAIG,MAAM,GAAGrF,IAAI,CAACyD,KAAL,CAAW0B,WAAW,CAAC,CAAD,CAAX,CAAejF,IAAf,GAAsBvC,iBAAjC,IAAsDqC,IAAI,CAACyD,KAAL,CAAW0B,WAAW,CAAC,CAAD,CAAX,CAAejF,IAAf,GAAsBvC,iBAAjC,CAAtD,GAA4G,CAAzH,CATkD,CAS0E;AAC5H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAIyB,IAAI,GAAG,IAAImB,IAAJ,CAAS4E,WAAW,CAAC,CAAD,CAAX,CAAejF,IAAxB,CAAX;AACA,QAAIoF,YAAY,GAAGlG,IAAI,CAACQ,OAAL,EAAnB;AACA,QAAI2F,UAAU,GAAGJ,WAAW,CAAC,CAAD,CAAX,CAAe/F,IAAf,CAAoBQ,OAApB,EAAjB;AACAR,IAAAA,IAAI,CAACoB,OAAL,CAAa8E,YAAY,GAAGD,MAAf,GAAwB,CAArC,EAvBkD,CAuBT;;AAEzC,QAAIG,OAAO,GAAGpG,IAAI,CAACQ,OAAL,EAAd;;AAEA,QAAI4F,OAAO,KAAKD,UAAhB,EAA4B;AAC1B,UAAIE,IAAI,GAAGrG,IAAI,CAACe,OAAL,KAAiBgF,WAAW,CAAC,CAAD,CAAX,CAAejF,IAAhC,GAAuC,CAAvC,GAA2C,CAA3C,GAA+C,CAAC,CAA3D;;AAEA,aAAO,CAACsF,OAAO,GAAGpG,IAAI,CAACQ,OAAL,EAAX,MAA+B2F,UAA/B,IAA6C,CAACnG,IAAI,CAACe,OAAL,KAAiBgF,WAAW,CAAC,CAAD,CAAX,CAAejF,IAAjC,IAAyCuF,IAAzC,GAAgD,CAApG,EAAuG;AACrGJ,QAAAA,MAAM,IAAII,IAAV;AACArG,QAAAA,IAAI,CAACoB,OAAL,CAAagF,OAAO,GAAGC,IAAvB;AACD;AACF;;AAED,QAAIzE,KAAK,GAAGhB,IAAI,CAACyD,KAAL,CAAW,CAAC4B,MAAM,GAAGF,WAAW,CAAC,CAAD,CAAX,CAAerF,GAAxB,GAA8B,CAA/B,IAAoC,CAA/C,CAAZ;AACA,QAAI8C,OAAO,GAAGwC,QAAQ,GAAG,CAACpE,KAAD,GAAS,CAAZ,GAAgBA,KAAK,GAAG,CAA9C;AACAoE,IAAAA,QAAQ,IAAID,WAAW,CAACD,OAAZ,EAAZ;AACA,WAAO;AACL3C,MAAAA,KAAK,EAAE,CAAC4C,WAAW,CAAC,CAAD,CAAX,CAAe/E,YAAhB,EAA8B+E,WAAW,CAAC,CAAD,CAAX,CAAe/E,YAA7C,CADF;AAELoC,MAAAA,KAAK,EAAE2C,WAAW,CAAC,CAAD,CAFb;AAGL1C,MAAAA,GAAG,EAAE0C,WAAW,CAAC,CAAD,CAHX;AAILE,MAAAA,MAAM,EAAEA,MAJH;AAKLrE,MAAAA,KAAK,EAAEA,KALF;AAML;AACA4B,MAAAA,OAAO,EAAEA,OAPJ;AAQL8C,MAAAA,KAAK,EAAEP,WAAW,CAAC,CAAD,CAAX,CAAerF,GARjB;AASL6F,MAAAA,KAAK,EAAER,WAAW,CAAC,CAAD,CAAX,CAAerF;AATjB,KAAP;AAWD,GAlDD;AAmDA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGElC,EAAAA,QAAQ,CAACS,SAAT,CAAmBsF,qBAAnB,GAA2C,UAAUf,OAAV,EAAmB9C,GAAnB,EAAwByC,KAAxB,EAA+B;AACxE,QAAIqD,SAAS,GAAG,KAAK9E,aAAL,CAAmByB,KAAnB,CAAhB;;AAEA,QAAIK,OAAO,GAAGgD,SAAS,CAAC5E,KAApB,IAA6B4B,OAAO,KAAK,CAAZ,IAAiB9C,GAAG,GAAG8F,SAAS,CAACF,KAA9D,IAAuE9C,OAAO,KAAKgD,SAAS,CAAC5E,KAAtB,IAA+BlB,GAAG,GAAG8F,SAAS,CAACD,KAA1H,EAAiI;AAC/H,aAAO,IAAP;AACD;;AAED,QAAIE,MAAM,GAAG,CAACjD,OAAO,GAAG,CAAX,IAAgB,CAAhB,GAAoBgD,SAAS,CAACF,KAA9B,GAAsC5F,GAAnD;AACA,QAAIV,IAAI,GAAG,IAAImB,IAAJ,CAASqF,SAAS,CAACpD,KAAV,CAAgBtC,IAAzB,CAAX;AACAd,IAAAA,IAAI,CAACoB,OAAL,CAAa,CAACoF,SAAS,CAACpD,KAAV,CAAgB7C,CAAjB,GAAqBkG,MAAlC;AACA,WAAO,KAAK1G,WAAL,CAAiBC,IAAjB,CAAP;AACD,GAXD;;AAaAxB,EAAAA,QAAQ,CAACkI,MAAT,GAAkB,UAAUhI,OAAV,EAAmBC,GAAnB,EAAwB;AACxC,QAAIgI,YAAY,GAAG,EAAnB;AACAjI,IAAAA,OAAO,CAACkI,aAAR,CAAsB,UAAtB,EAAkC,UAAUnI,aAAV,EAAyB;AACzD,UAAIoI,QAAQ,GAAG,IAAIrI,QAAJ,CAAaC,aAAb,EAA4BC,OAA5B,EAAqCC,GAArC,CAAf;AACAgI,MAAAA,YAAY,CAACG,IAAb,CAAkBD,QAAlB;AACApI,MAAAA,aAAa,CAACsI,gBAAd,GAAiCF,QAAjC;AACD,KAJD;AAKAnI,IAAAA,OAAO,CAACsI,UAAR,CAAmB,UAAUC,cAAV,EAA0B;AAC3C,UAAIA,cAAc,CAAC3F,GAAf,CAAmB,kBAAnB,MAA2C,UAA/C,EAA2D;AACzD;AACA2F,QAAAA,cAAc,CAACF,gBAAf,GAAkCJ,YAAY,CAACM,cAAc,CAAC3F,GAAf,CAAmB,eAAnB,KAAuC,CAAxC,CAA9C;AACD;AACF,KALD;AAMA,WAAOqF,YAAP;AACD,GAdD;;AAgBAnI,EAAAA,QAAQ,CAACK,UAAT,GAAsB,CAAC,MAAD,EAAS,OAAT,CAAtB;AACA,SAAOL,QAAP;AACD,CA3XD,EAFA;;AA+XA,SAASoG,WAAT,CAAqBH,MAArB,EAA6B;AAC3B,MAAIhG,aAAa,GAAGgG,MAAM,CAAChG,aAA3B;AACA,MAAIyI,WAAW,GAAGzC,MAAM,CAACyC,WAAzB;AACA,MAAIvC,QAAQ,GAAGlG,aAAa,GAAGA,aAAa,CAACsI,gBAAjB,GAAoCG,WAAW,GAAGA,WAAW,CAACH,gBAAf,GAAkC,IAA7G;AACA,SAAOpC,QAAP;AACD;;AAED,eAAenG,QAAf","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util';\nimport * as layout from '../../util/layout';\nimport * as numberUtil from '../../util/number'; // (24*60*60*1000)\n\nvar PROXIMATE_ONE_DAY = 86400000;\n\nvar Calendar =\n/** @class */\nfunction () {\n  function Calendar(calendarModel, ecModel, api) {\n    this.type = 'calendar';\n    this.dimensions = Calendar.dimensions; // Required in createListFromData\n\n    this.getDimensionsInfo = Calendar.getDimensionsInfo;\n    this._model = calendarModel;\n  }\n\n  Calendar.getDimensionsInfo = function () {\n    return [{\n      name: 'time',\n      type: 'time'\n    }, 'value'];\n  };\n\n  Calendar.prototype.getRangeInfo = function () {\n    return this._rangeInfo;\n  };\n\n  Calendar.prototype.getModel = function () {\n    return this._model;\n  };\n\n  Calendar.prototype.getRect = function () {\n    return this._rect;\n  };\n\n  Calendar.prototype.getCellWidth = function () {\n    return this._sw;\n  };\n\n  Calendar.prototype.getCellHeight = function () {\n    return this._sh;\n  };\n\n  Calendar.prototype.getOrient = function () {\n    return this._orient;\n  };\n  /**\n   * getFirstDayOfWeek\n   *\n   * @example\n   *     0 : start at Sunday\n   *     1 : start at Monday\n   *\n   * @return {number}\n   */\n\n\n  Calendar.prototype.getFirstDayOfWeek = function () {\n    return this._firstDayOfWeek;\n  };\n  /**\n   * get date info\n   * }\n   */\n\n\n  Calendar.prototype.getDateInfo = function (date) {\n    date = numberUtil.parseDate(date);\n    var y = date.getFullYear();\n    var m = date.getMonth() + 1;\n    var mStr = m < 10 ? '0' + m : '' + m;\n    var d = date.getDate();\n    var dStr = d < 10 ? '0' + d : '' + d;\n    var day = date.getDay();\n    day = Math.abs((day + 7 - this.getFirstDayOfWeek()) % 7);\n    return {\n      y: y + '',\n      m: mStr,\n      d: dStr,\n      day: day,\n      time: date.getTime(),\n      formatedDate: y + '-' + mStr + '-' + dStr,\n      date: date\n    };\n  };\n\n  Calendar.prototype.getNextNDay = function (date, n) {\n    n = n || 0;\n\n    if (n === 0) {\n      return this.getDateInfo(date);\n    }\n\n    date = new Date(this.getDateInfo(date).time);\n    date.setDate(date.getDate() + n);\n    return this.getDateInfo(date);\n  };\n\n  Calendar.prototype.update = function (ecModel, api) {\n    this._firstDayOfWeek = +this._model.getModel('dayLabel').get('firstDay');\n    this._orient = this._model.get('orient');\n    this._lineWidth = this._model.getModel('itemStyle').getItemStyle().lineWidth || 0;\n    this._rangeInfo = this._getRangeInfo(this._initRangeOption());\n    var weeks = this._rangeInfo.weeks || 1;\n    var whNames = ['width', 'height'];\n\n    var cellSize = this._model.getCellSize().slice();\n\n    var layoutParams = this._model.getBoxLayoutParams();\n\n    var cellNumbers = this._orient === 'horizontal' ? [weeks, 7] : [7, weeks];\n    zrUtil.each([0, 1], function (idx) {\n      if (cellSizeSpecified(cellSize, idx)) {\n        layoutParams[whNames[idx]] = cellSize[idx] * cellNumbers[idx];\n      }\n    });\n    var whGlobal = {\n      width: api.getWidth(),\n      height: api.getHeight()\n    };\n    var calendarRect = this._rect = layout.getLayoutRect(layoutParams, whGlobal);\n    zrUtil.each([0, 1], function (idx) {\n      if (!cellSizeSpecified(cellSize, idx)) {\n        cellSize[idx] = calendarRect[whNames[idx]] / cellNumbers[idx];\n      }\n    });\n\n    function cellSizeSpecified(cellSize, idx) {\n      return cellSize[idx] != null && cellSize[idx] !== 'auto';\n    } // Has been calculated out number.\n\n\n    this._sw = cellSize[0];\n    this._sh = cellSize[1];\n  };\n  /**\n   * Convert a time data(time, value) item to (x, y) point.\n   */\n  // TODO Clamp of calendar is not same with cartesian coordinate systems.\n  // It will return NaN if data exceeds.\n\n\n  Calendar.prototype.dataToPoint = function (data, clamp) {\n    zrUtil.isArray(data) && (data = data[0]);\n    clamp == null && (clamp = true);\n    var dayInfo = this.getDateInfo(data);\n    var range = this._rangeInfo;\n    var date = dayInfo.formatedDate; // if not in range return [NaN, NaN]\n\n    if (clamp && !(dayInfo.time >= range.start.time && dayInfo.time < range.end.time + PROXIMATE_ONE_DAY)) {\n      return [NaN, NaN];\n    }\n\n    var week = dayInfo.day;\n\n    var nthWeek = this._getRangeInfo([range.start.time, date]).nthWeek;\n\n    if (this._orient === 'vertical') {\n      return [this._rect.x + week * this._sw + this._sw / 2, this._rect.y + nthWeek * this._sh + this._sh / 2];\n    }\n\n    return [this._rect.x + nthWeek * this._sw + this._sw / 2, this._rect.y + week * this._sh + this._sh / 2];\n  };\n  /**\n   * Convert a (x, y) point to time data\n   */\n\n\n  Calendar.prototype.pointToData = function (point) {\n    var date = this.pointToDate(point);\n    return date && date.time;\n  };\n  /**\n   * Convert a time date item to (x, y) four point.\n   */\n\n\n  Calendar.prototype.dataToRect = function (data, clamp) {\n    var point = this.dataToPoint(data, clamp);\n    return {\n      contentShape: {\n        x: point[0] - (this._sw - this._lineWidth) / 2,\n        y: point[1] - (this._sh - this._lineWidth) / 2,\n        width: this._sw - this._lineWidth,\n        height: this._sh - this._lineWidth\n      },\n      center: point,\n      tl: [point[0] - this._sw / 2, point[1] - this._sh / 2],\n      tr: [point[0] + this._sw / 2, point[1] - this._sh / 2],\n      br: [point[0] + this._sw / 2, point[1] + this._sh / 2],\n      bl: [point[0] - this._sw / 2, point[1] + this._sh / 2]\n    };\n  };\n  /**\n   * Convert a (x, y) point to time date\n   *\n   * @param  {Array} point point\n   * @return {Object}       date\n   */\n\n\n  Calendar.prototype.pointToDate = function (point) {\n    var nthX = Math.floor((point[0] - this._rect.x) / this._sw) + 1;\n    var nthY = Math.floor((point[1] - this._rect.y) / this._sh) + 1;\n    var range = this._rangeInfo.range;\n\n    if (this._orient === 'vertical') {\n      return this._getDateByWeeksAndDay(nthY, nthX - 1, range);\n    }\n\n    return this._getDateByWeeksAndDay(nthX, nthY - 1, range);\n  };\n\n  Calendar.prototype.convertToPixel = function (ecModel, finder, value) {\n    var coordSys = getCoordSys(finder);\n    return coordSys === this ? coordSys.dataToPoint(value) : null;\n  };\n\n  Calendar.prototype.convertFromPixel = function (ecModel, finder, pixel) {\n    var coordSys = getCoordSys(finder);\n    return coordSys === this ? coordSys.pointToData(pixel) : null;\n  };\n\n  Calendar.prototype.containPoint = function (point) {\n    console.warn('Not implemented.');\n    return false;\n  };\n  /**\n   * initRange\n   * Normalize to an [start, end] array\n   */\n\n\n  Calendar.prototype._initRangeOption = function () {\n    var range = this._model.get('range');\n\n    var normalizedRange; // Convert [1990] to 1990\n\n    if (zrUtil.isArray(range) && range.length === 1) {\n      range = range[0];\n    }\n\n    if (!zrUtil.isArray(range)) {\n      var rangeStr = range.toString(); // One year.\n\n      if (/^\\d{4}$/.test(rangeStr)) {\n        normalizedRange = [rangeStr + '-01-01', rangeStr + '-12-31'];\n      } // One month\n\n\n      if (/^\\d{4}[\\/|-]\\d{1,2}$/.test(rangeStr)) {\n        var start = this.getDateInfo(rangeStr);\n        var firstDay = start.date;\n        firstDay.setMonth(firstDay.getMonth() + 1);\n        var end = this.getNextNDay(firstDay, -1);\n        normalizedRange = [start.formatedDate, end.formatedDate];\n      } // One day\n\n\n      if (/^\\d{4}[\\/|-]\\d{1,2}[\\/|-]\\d{1,2}$/.test(rangeStr)) {\n        normalizedRange = [rangeStr, rangeStr];\n      }\n    } else {\n      normalizedRange = range;\n    }\n\n    if (!normalizedRange) {\n      if (process.env.NODE_ENV !== 'production') {\n        zrUtil.logError('Invalid date range.');\n      } // Not handling it.\n\n\n      return range;\n    }\n\n    var tmp = this._getRangeInfo(normalizedRange);\n\n    if (tmp.start.time > tmp.end.time) {\n      normalizedRange.reverse();\n    }\n\n    return normalizedRange;\n  };\n  /**\n   * range info\n   *\n   * @private\n   * @param  {Array} range range ['2017-01-01', '2017-07-08']\n   *  If range[0] > range[1], they will not be reversed.\n   * @return {Object}       obj\n   */\n\n\n  Calendar.prototype._getRangeInfo = function (range) {\n    var parsedRange = [this.getDateInfo(range[0]), this.getDateInfo(range[1])];\n    var reversed;\n\n    if (parsedRange[0].time > parsedRange[1].time) {\n      reversed = true;\n      parsedRange.reverse();\n    }\n\n    var allDay = Math.floor(parsedRange[1].time / PROXIMATE_ONE_DAY) - Math.floor(parsedRange[0].time / PROXIMATE_ONE_DAY) + 1; // Consider case1 (#11677 #10430):\n    // Set the system timezone as \"UK\", set the range to `['2016-07-01', '2016-12-31']`\n    // Consider case2:\n    // Firstly set system timezone as \"Time Zone: America/Toronto\",\n    // ```\n    // let first = new Date(1478412000000 - 3600 * 1000 * 2.5);\n    // let second = new Date(1478412000000);\n    // let allDays = Math.floor(second / ONE_DAY) - Math.floor(first / ONE_DAY) + 1;\n    // ```\n    // will get wrong result because of DST. So we should fix it.\n\n    var date = new Date(parsedRange[0].time);\n    var startDateNum = date.getDate();\n    var endDateNum = parsedRange[1].date.getDate();\n    date.setDate(startDateNum + allDay - 1); // The bias can not over a month, so just compare date.\n\n    var dateNum = date.getDate();\n\n    if (dateNum !== endDateNum) {\n      var sign = date.getTime() - parsedRange[1].time > 0 ? 1 : -1;\n\n      while ((dateNum = date.getDate()) !== endDateNum && (date.getTime() - parsedRange[1].time) * sign > 0) {\n        allDay -= sign;\n        date.setDate(dateNum - sign);\n      }\n    }\n\n    var weeks = Math.floor((allDay + parsedRange[0].day + 6) / 7);\n    var nthWeek = reversed ? -weeks + 1 : weeks - 1;\n    reversed && parsedRange.reverse();\n    return {\n      range: [parsedRange[0].formatedDate, parsedRange[1].formatedDate],\n      start: parsedRange[0],\n      end: parsedRange[1],\n      allDay: allDay,\n      weeks: weeks,\n      // From 0.\n      nthWeek: nthWeek,\n      fweek: parsedRange[0].day,\n      lweek: parsedRange[1].day\n    };\n  };\n  /**\n   * get date by nthWeeks and week day in range\n   *\n   * @private\n   * @param  {number} nthWeek the week\n   * @param  {number} day   the week day\n   * @param  {Array} range [d1, d2]\n   * @return {Object}\n   */\n\n\n  Calendar.prototype._getDateByWeeksAndDay = function (nthWeek, day, range) {\n    var rangeInfo = this._getRangeInfo(range);\n\n    if (nthWeek > rangeInfo.weeks || nthWeek === 0 && day < rangeInfo.fweek || nthWeek === rangeInfo.weeks && day > rangeInfo.lweek) {\n      return null;\n    }\n\n    var nthDay = (nthWeek - 1) * 7 - rangeInfo.fweek + day;\n    var date = new Date(rangeInfo.start.time);\n    date.setDate(+rangeInfo.start.d + nthDay);\n    return this.getDateInfo(date);\n  };\n\n  Calendar.create = function (ecModel, api) {\n    var calendarList = [];\n    ecModel.eachComponent('calendar', function (calendarModel) {\n      var calendar = new Calendar(calendarModel, ecModel, api);\n      calendarList.push(calendar);\n      calendarModel.coordinateSystem = calendar;\n    });\n    ecModel.eachSeries(function (calendarSeries) {\n      if (calendarSeries.get('coordinateSystem') === 'calendar') {\n        // Inject coordinate system\n        calendarSeries.coordinateSystem = calendarList[calendarSeries.get('calendarIndex') || 0];\n      }\n    });\n    return calendarList;\n  };\n\n  Calendar.dimensions = ['time', 'value'];\n  return Calendar;\n}();\n\nfunction getCoordSys(finder) {\n  var calendarModel = finder.calendarModel;\n  var seriesModel = finder.seriesModel;\n  var coordSys = calendarModel ? calendarModel.coordinateSystem : seriesModel ? seriesModel.coordinateSystem : null;\n  return coordSys;\n}\n\nexport default Calendar;"]},"metadata":{},"sourceType":"module"}