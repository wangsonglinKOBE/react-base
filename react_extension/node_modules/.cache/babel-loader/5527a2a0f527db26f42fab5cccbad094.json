{"ast":null,"code":"function diff(oldArr, newArr, equals) {\n  if (!equals) {\n    equals = function (a, b) {\n      return a === b;\n    };\n  }\n\n  oldArr = oldArr.slice();\n  newArr = newArr.slice();\n  var newLen = newArr.length;\n  var oldLen = oldArr.length;\n  var editLength = 1;\n  var maxEditLength = newLen + oldLen;\n  var bestPath = [{\n    newPos: -1,\n    components: []\n  }];\n  var oldPos = extractCommon(bestPath[0], newArr, oldArr, 0, equals);\n\n  if (bestPath[0].newPos + 1 >= newLen && oldPos + 1 >= oldLen) {\n    var indices = [];\n\n    for (var i = 0; i < newArr.length; i++) {\n      indices.push(i);\n    }\n\n    return [{\n      indices: indices,\n      count: newArr.length,\n      added: false,\n      removed: false\n    }];\n  }\n\n  function execEditLength() {\n    for (var diagonalPath = -1 * editLength; diagonalPath <= editLength; diagonalPath += 2) {\n      var basePath;\n      var addPath = bestPath[diagonalPath - 1];\n      var removePath = bestPath[diagonalPath + 1];\n      var oldPos = (removePath ? removePath.newPos : 0) - diagonalPath;\n\n      if (addPath) {\n        bestPath[diagonalPath - 1] = undefined;\n      }\n\n      var canAdd = addPath && addPath.newPos + 1 < newLen;\n      var canRemove = removePath && 0 <= oldPos && oldPos < oldLen;\n\n      if (!canAdd && !canRemove) {\n        bestPath[diagonalPath] = undefined;\n        continue;\n      }\n\n      if (!canAdd || canRemove && addPath.newPos < removePath.newPos) {\n        basePath = clonePath(removePath);\n        pushComponent(basePath.components, false, true);\n      } else {\n        basePath = addPath;\n        basePath.newPos++;\n        pushComponent(basePath.components, true, false);\n      }\n\n      oldPos = extractCommon(basePath, newArr, oldArr, diagonalPath, equals);\n\n      if (basePath.newPos + 1 >= newLen && oldPos + 1 >= oldLen) {\n        return buildValues(basePath.components);\n      } else {\n        bestPath[diagonalPath] = basePath;\n      }\n    }\n\n    editLength++;\n  }\n\n  while (editLength <= maxEditLength) {\n    var ret = execEditLength();\n\n    if (ret) {\n      return ret;\n    }\n  }\n}\n\nfunction extractCommon(basePath, newArr, oldArr, diagonalPath, equals) {\n  var newLen = newArr.length;\n  var oldLen = oldArr.length;\n  var newPos = basePath.newPos;\n  var oldPos = newPos - diagonalPath;\n  var commonCount = 0;\n\n  while (newPos + 1 < newLen && oldPos + 1 < oldLen && equals(newArr[newPos + 1], oldArr[oldPos + 1])) {\n    newPos++;\n    oldPos++;\n    commonCount++;\n  }\n\n  if (commonCount) {\n    basePath.components.push({\n      count: commonCount,\n      added: false,\n      removed: false,\n      indices: []\n    });\n  }\n\n  basePath.newPos = newPos;\n  return oldPos;\n}\n\nfunction pushComponent(components, added, removed) {\n  var last = components[components.length - 1];\n\n  if (last && last.added === added && last.removed === removed) {\n    components[components.length - 1] = {\n      count: last.count + 1,\n      added: added,\n      removed: removed,\n      indices: []\n    };\n  } else {\n    components.push({\n      count: 1,\n      added: added,\n      removed: removed,\n      indices: []\n    });\n  }\n}\n\nfunction buildValues(components) {\n  var componentPos = 0;\n  var componentLen = components.length;\n  var newPos = 0;\n  var oldPos = 0;\n\n  for (; componentPos < componentLen; componentPos++) {\n    var component = components[componentPos];\n\n    if (!component.removed) {\n      var indices = [];\n\n      for (var i = newPos; i < newPos + component.count; i++) {\n        indices.push(i);\n      }\n\n      component.indices = indices;\n      newPos += component.count;\n\n      if (!component.added) {\n        oldPos += component.count;\n      }\n    } else {\n      for (var i = oldPos; i < oldPos + component.count; i++) {\n        component.indices.push(i);\n      }\n\n      oldPos += component.count;\n    }\n  }\n\n  return components;\n}\n\nfunction clonePath(path) {\n  return {\n    newPos: path.newPos,\n    components: path.components.slice(0)\n  };\n}\n\nexport default function arrayDiff(oldArr, newArr, equal) {\n  return diff(oldArr, newArr, equal);\n}","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/zrender/lib/core/arrayDiff.js"],"names":["diff","oldArr","newArr","equals","a","b","slice","newLen","length","oldLen","editLength","maxEditLength","bestPath","newPos","components","oldPos","extractCommon","indices","i","push","count","added","removed","execEditLength","diagonalPath","basePath","addPath","removePath","undefined","canAdd","canRemove","clonePath","pushComponent","buildValues","ret","commonCount","last","componentPos","componentLen","component","path","arrayDiff","equal"],"mappings":"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","sourcesContent":["function diff(oldArr, newArr, equals) {\n    if (!equals) {\n        equals = function (a, b) {\n            return a === b;\n        };\n    }\n    oldArr = oldArr.slice();\n    newArr = newArr.slice();\n    var newLen = newArr.length;\n    var oldLen = oldArr.length;\n    var editLength = 1;\n    var maxEditLength = newLen + oldLen;\n    var bestPath = [{ newPos: -1, components: [] }];\n    var oldPos = extractCommon(bestPath[0], newArr, oldArr, 0, equals);\n    if (bestPath[0].newPos + 1 >= newLen && oldPos + 1 >= oldLen) {\n        var indices = [];\n        for (var i = 0; i < newArr.length; i++) {\n            indices.push(i);\n        }\n        return [{\n                indices: indices,\n                count: newArr.length,\n                added: false,\n                removed: false\n            }];\n    }\n    function execEditLength() {\n        for (var diagonalPath = -1 * editLength; diagonalPath <= editLength; diagonalPath += 2) {\n            var basePath;\n            var addPath = bestPath[diagonalPath - 1];\n            var removePath = bestPath[diagonalPath + 1];\n            var oldPos = (removePath ? removePath.newPos : 0) - diagonalPath;\n            if (addPath) {\n                bestPath[diagonalPath - 1] = undefined;\n            }\n            var canAdd = addPath && addPath.newPos + 1 < newLen;\n            var canRemove = removePath && 0 <= oldPos && oldPos < oldLen;\n            if (!canAdd && !canRemove) {\n                bestPath[diagonalPath] = undefined;\n                continue;\n            }\n            if (!canAdd || (canRemove && addPath.newPos < removePath.newPos)) {\n                basePath = clonePath(removePath);\n                pushComponent(basePath.components, false, true);\n            }\n            else {\n                basePath = addPath;\n                basePath.newPos++;\n                pushComponent(basePath.components, true, false);\n            }\n            oldPos = extractCommon(basePath, newArr, oldArr, diagonalPath, equals);\n            if (basePath.newPos + 1 >= newLen && oldPos + 1 >= oldLen) {\n                return buildValues(basePath.components);\n            }\n            else {\n                bestPath[diagonalPath] = basePath;\n            }\n        }\n        editLength++;\n    }\n    while (editLength <= maxEditLength) {\n        var ret = execEditLength();\n        if (ret) {\n            return ret;\n        }\n    }\n}\nfunction extractCommon(basePath, newArr, oldArr, diagonalPath, equals) {\n    var newLen = newArr.length;\n    var oldLen = oldArr.length;\n    var newPos = basePath.newPos;\n    var oldPos = newPos - diagonalPath;\n    var commonCount = 0;\n    while (newPos + 1 < newLen && oldPos + 1 < oldLen && equals(newArr[newPos + 1], oldArr[oldPos + 1])) {\n        newPos++;\n        oldPos++;\n        commonCount++;\n    }\n    if (commonCount) {\n        basePath.components.push({\n            count: commonCount,\n            added: false,\n            removed: false,\n            indices: []\n        });\n    }\n    basePath.newPos = newPos;\n    return oldPos;\n}\nfunction pushComponent(components, added, removed) {\n    var last = components[components.length - 1];\n    if (last && last.added === added && last.removed === removed) {\n        components[components.length - 1] = {\n            count: last.count + 1,\n            added: added,\n            removed: removed,\n            indices: []\n        };\n    }\n    else {\n        components.push({\n            count: 1,\n            added: added,\n            removed: removed,\n            indices: []\n        });\n    }\n}\nfunction buildValues(components) {\n    var componentPos = 0;\n    var componentLen = components.length;\n    var newPos = 0;\n    var oldPos = 0;\n    for (; componentPos < componentLen; componentPos++) {\n        var component = components[componentPos];\n        if (!component.removed) {\n            var indices = [];\n            for (var i = newPos; i < newPos + component.count; i++) {\n                indices.push(i);\n            }\n            component.indices = indices;\n            newPos += component.count;\n            if (!component.added) {\n                oldPos += component.count;\n            }\n        }\n        else {\n            for (var i = oldPos; i < oldPos + component.count; i++) {\n                component.indices.push(i);\n            }\n            oldPos += component.count;\n        }\n    }\n    return components;\n}\nfunction clonePath(path) {\n    return { newPos: path.newPos, components: path.components.slice(0) };\n}\nexport default function arrayDiff(oldArr, newArr, equal) {\n    return diff(oldArr, newArr, equal);\n}\n"]},"metadata":{},"sourceType":"module"}