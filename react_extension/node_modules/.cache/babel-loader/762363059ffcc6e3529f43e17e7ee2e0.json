{"ast":null,"code":"import LRU from '../../core/LRU';\nvar globalImageCache = new LRU(50);\nexport function findExistImage(newImageOrSrc) {\n  if (typeof newImageOrSrc === 'string') {\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    return cachedImgObj && cachedImgObj.image;\n  } else {\n    return newImageOrSrc;\n  }\n}\nexport function createOrUpdateImage(newImageOrSrc, image, hostEl, onload, cbPayload) {\n  if (!newImageOrSrc) {\n    return image;\n  } else if (typeof newImageOrSrc === 'string') {\n    if (image && image.__zrImageSrc === newImageOrSrc || !hostEl) {\n      return image;\n    }\n\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    var pendingWrap = {\n      hostEl: hostEl,\n      cb: onload,\n      cbPayload: cbPayload\n    };\n\n    if (cachedImgObj) {\n      image = cachedImgObj.image;\n      !isImageReady(image) && cachedImgObj.pending.push(pendingWrap);\n    } else {\n      image = new Image();\n      image.onload = image.onerror = imageOnLoad;\n      globalImageCache.put(newImageOrSrc, image.__cachedImgObj = {\n        image: image,\n        pending: [pendingWrap]\n      });\n      image.src = image.__zrImageSrc = newImageOrSrc;\n    }\n\n    return image;\n  } else {\n    return newImageOrSrc;\n  }\n}\n\nfunction imageOnLoad() {\n  var cachedImgObj = this.__cachedImgObj;\n  this.onload = this.onerror = this.__cachedImgObj = null;\n\n  for (var i = 0; i < cachedImgObj.pending.length; i++) {\n    var pendingWrap = cachedImgObj.pending[i];\n    var cb = pendingWrap.cb;\n    cb && cb(this, pendingWrap.cbPayload);\n    pendingWrap.hostEl.dirty();\n  }\n\n  cachedImgObj.pending.length = 0;\n}\n\nexport function isImageReady(image) {\n  return image && image.width && image.height;\n}","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/zrender/lib/graphic/helper/image.js"],"names":["LRU","globalImageCache","findExistImage","newImageOrSrc","cachedImgObj","get","image","createOrUpdateImage","hostEl","onload","cbPayload","__zrImageSrc","pendingWrap","cb","isImageReady","pending","push","Image","onerror","imageOnLoad","put","__cachedImgObj","src","i","length","dirty","width","height"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,gBAAhB;AACA,IAAIC,gBAAgB,GAAG,IAAID,GAAJ,CAAQ,EAAR,CAAvB;AACA,OAAO,SAASE,cAAT,CAAwBC,aAAxB,EAAuC;AAC1C,MAAI,OAAOA,aAAP,KAAyB,QAA7B,EAAuC;AACnC,QAAIC,YAAY,GAAGH,gBAAgB,CAACI,GAAjB,CAAqBF,aAArB,CAAnB;AACA,WAAOC,YAAY,IAAIA,YAAY,CAACE,KAApC;AACH,GAHD,MAIK;AACD,WAAOH,aAAP;AACH;AACJ;AACD,OAAO,SAASI,mBAAT,CAA6BJ,aAA7B,EAA4CG,KAA5C,EAAmDE,MAAnD,EAA2DC,MAA3D,EAAmEC,SAAnE,EAA8E;AACjF,MAAI,CAACP,aAAL,EAAoB;AAChB,WAAOG,KAAP;AACH,GAFD,MAGK,IAAI,OAAOH,aAAP,KAAyB,QAA7B,EAAuC;AACxC,QAAKG,KAAK,IAAIA,KAAK,CAACK,YAAN,KAAuBR,aAAjC,IAAmD,CAACK,MAAxD,EAAgE;AAC5D,aAAOF,KAAP;AACH;;AACD,QAAIF,YAAY,GAAGH,gBAAgB,CAACI,GAAjB,CAAqBF,aAArB,CAAnB;AACA,QAAIS,WAAW,GAAG;AAAEJ,MAAAA,MAAM,EAAEA,MAAV;AAAkBK,MAAAA,EAAE,EAAEJ,MAAtB;AAA8BC,MAAAA,SAAS,EAAEA;AAAzC,KAAlB;;AACA,QAAIN,YAAJ,EAAkB;AACdE,MAAAA,KAAK,GAAGF,YAAY,CAACE,KAArB;AACA,OAACQ,YAAY,CAACR,KAAD,CAAb,IAAwBF,YAAY,CAACW,OAAb,CAAqBC,IAArB,CAA0BJ,WAA1B,CAAxB;AACH,KAHD,MAIK;AACDN,MAAAA,KAAK,GAAG,IAAIW,KAAJ,EAAR;AACAX,MAAAA,KAAK,CAACG,MAAN,GAAeH,KAAK,CAACY,OAAN,GAAgBC,WAA/B;AACAlB,MAAAA,gBAAgB,CAACmB,GAAjB,CAAqBjB,aAArB,EAAoCG,KAAK,CAACe,cAAN,GAAuB;AACvDf,QAAAA,KAAK,EAAEA,KADgD;AAEvDS,QAAAA,OAAO,EAAE,CAACH,WAAD;AAF8C,OAA3D;AAIAN,MAAAA,KAAK,CAACgB,GAAN,GAAYhB,KAAK,CAACK,YAAN,GAAqBR,aAAjC;AACH;;AACD,WAAOG,KAAP;AACH,GApBI,MAqBA;AACD,WAAOH,aAAP;AACH;AACJ;;AACD,SAASgB,WAAT,GAAuB;AACnB,MAAIf,YAAY,GAAG,KAAKiB,cAAxB;AACA,OAAKZ,MAAL,GAAc,KAAKS,OAAL,GAAe,KAAKG,cAAL,GAAsB,IAAnD;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnB,YAAY,CAACW,OAAb,CAAqBS,MAAzC,EAAiDD,CAAC,EAAlD,EAAsD;AAClD,QAAIX,WAAW,GAAGR,YAAY,CAACW,OAAb,CAAqBQ,CAArB,CAAlB;AACA,QAAIV,EAAE,GAAGD,WAAW,CAACC,EAArB;AACAA,IAAAA,EAAE,IAAIA,EAAE,CAAC,IAAD,EAAOD,WAAW,CAACF,SAAnB,CAAR;AACAE,IAAAA,WAAW,CAACJ,MAAZ,CAAmBiB,KAAnB;AACH;;AACDrB,EAAAA,YAAY,CAACW,OAAb,CAAqBS,MAArB,GAA8B,CAA9B;AACH;;AACD,OAAO,SAASV,YAAT,CAAsBR,KAAtB,EAA6B;AAChC,SAAOA,KAAK,IAAIA,KAAK,CAACoB,KAAf,IAAwBpB,KAAK,CAACqB,MAArC;AACH","sourcesContent":["import LRU from '../../core/LRU';\nvar globalImageCache = new LRU(50);\nexport function findExistImage(newImageOrSrc) {\n    if (typeof newImageOrSrc === 'string') {\n        var cachedImgObj = globalImageCache.get(newImageOrSrc);\n        return cachedImgObj && cachedImgObj.image;\n    }\n    else {\n        return newImageOrSrc;\n    }\n}\nexport function createOrUpdateImage(newImageOrSrc, image, hostEl, onload, cbPayload) {\n    if (!newImageOrSrc) {\n        return image;\n    }\n    else if (typeof newImageOrSrc === 'string') {\n        if ((image && image.__zrImageSrc === newImageOrSrc) || !hostEl) {\n            return image;\n        }\n        var cachedImgObj = globalImageCache.get(newImageOrSrc);\n        var pendingWrap = { hostEl: hostEl, cb: onload, cbPayload: cbPayload };\n        if (cachedImgObj) {\n            image = cachedImgObj.image;\n            !isImageReady(image) && cachedImgObj.pending.push(pendingWrap);\n        }\n        else {\n            image = new Image();\n            image.onload = image.onerror = imageOnLoad;\n            globalImageCache.put(newImageOrSrc, image.__cachedImgObj = {\n                image: image,\n                pending: [pendingWrap]\n            });\n            image.src = image.__zrImageSrc = newImageOrSrc;\n        }\n        return image;\n    }\n    else {\n        return newImageOrSrc;\n    }\n}\nfunction imageOnLoad() {\n    var cachedImgObj = this.__cachedImgObj;\n    this.onload = this.onerror = this.__cachedImgObj = null;\n    for (var i = 0; i < cachedImgObj.pending.length; i++) {\n        var pendingWrap = cachedImgObj.pending[i];\n        var cb = pendingWrap.cb;\n        cb && cb(this, pendingWrap.cbPayload);\n        pendingWrap.hostEl.dirty();\n    }\n    cachedImgObj.pending.length = 0;\n}\nexport function isImageReady(image) {\n    return image && image.width && image.height;\n}\n"]},"metadata":{},"sourceType":"module"}