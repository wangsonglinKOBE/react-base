{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { each, isString, createHashMap } from 'zrender/lib/core/util';\nimport parseGeoJson from './parseGeoJson'; // Built-in GEO fixer.\n\nimport fixNanhai from './fix/nanhai';\nimport fixTextCoord from './fix/textCoord';\nimport fixGeoCoord from './fix/geoCoord';\nimport fixDiaoyuIsland from './fix/diaoyuIsland';\nimport BoundingRect from 'zrender/lib/core/BoundingRect';\nvar DEFAULT_NAME_PROPERTY = 'name';\n\nvar GeoJSONResource =\n/** @class */\nfunction () {\n  function GeoJSONResource(mapName, geoJSON, specialAreas) {\n    this.type = 'geoJSON';\n    this._parsedMap = createHashMap();\n    this._mapName = mapName;\n    this._specialAreas = specialAreas; // PENDING: delay the parse to the first usage to rapid up the FMP?\n\n    this._geoJSON = parseInput(geoJSON);\n  }\n  /**\n   * @param nameMap can be null/undefined\n   * @param nameProperty can be null/undefined\n   */\n\n\n  GeoJSONResource.prototype.load = function (nameMap, nameProperty) {\n    nameProperty = nameProperty || DEFAULT_NAME_PROPERTY;\n\n    var parsed = this._parsedMap.get(nameProperty);\n\n    if (!parsed) {\n      var rawRegions = this._parseToRegions(nameProperty);\n\n      parsed = this._parsedMap.set(nameProperty, {\n        regions: rawRegions,\n        boundingRect: calculateBoundingRect(rawRegions)\n      });\n    }\n\n    var regionsMap = createHashMap();\n    var finalRegions = [];\n    each(parsed.regions, function (region) {\n      var regionName = region.name; // Try use the alias in geoNameMap\n\n      if (nameMap && nameMap.hasOwnProperty(regionName)) {\n        region = region.cloneShallow(regionName = nameMap[regionName]);\n      }\n\n      finalRegions.push(region);\n      regionsMap.set(regionName, region);\n    });\n    return {\n      regions: finalRegions,\n      boundingRect: parsed.boundingRect || new BoundingRect(0, 0, 0, 0),\n      regionsMap: regionsMap\n    };\n  };\n\n  GeoJSONResource.prototype._parseToRegions = function (nameProperty) {\n    var mapName = this._mapName;\n    var geoJSON = this._geoJSON;\n    var rawRegions; // https://jsperf.com/try-catch-performance-overhead\n\n    try {\n      rawRegions = geoJSON ? parseGeoJson(geoJSON, nameProperty) : [];\n    } catch (e) {\n      throw new Error('Invalid geoJson format\\n' + e.message);\n    }\n\n    fixNanhai(mapName, rawRegions);\n    each(rawRegions, function (region) {\n      var regionName = region.name;\n      fixTextCoord(mapName, region);\n      fixGeoCoord(mapName, region);\n      fixDiaoyuIsland(mapName, region); // Some area like Alaska in USA map needs to be tansformed\n      // to look better\n\n      var specialArea = this._specialAreas && this._specialAreas[regionName];\n\n      if (specialArea) {\n        region.transformTo(specialArea.left, specialArea.top, specialArea.width, specialArea.height);\n      }\n    }, this);\n    return rawRegions;\n  };\n  /**\n   * Only for exporting to users.\n   * **MUST NOT** used internally.\n   */\n\n\n  GeoJSONResource.prototype.getMapForUser = function () {\n    return {\n      // For backward compatibility, use geoJson\n      // PENDING: it has been returning them without clone.\n      // do we need to avoid outsite modification?\n      geoJson: this._geoJSON,\n      geoJSON: this._geoJSON,\n      specialAreas: this._specialAreas\n    };\n  };\n\n  return GeoJSONResource;\n}();\n\nexport { GeoJSONResource };\n\nfunction calculateBoundingRect(regions) {\n  var rect;\n\n  for (var i = 0; i < regions.length; i++) {\n    var regionRect = regions[i].getBoundingRect();\n    rect = rect || regionRect.clone();\n    rect.union(regionRect);\n  }\n\n  return rect;\n}\n\nfunction parseInput(source) {\n  return !isString(source) ? source : typeof JSON !== 'undefined' && JSON.parse ? JSON.parse(source) : new Function('return (' + source + ');')();\n}","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/echarts/lib/coord/geo/GeoJSONResource.js"],"names":["each","isString","createHashMap","parseGeoJson","fixNanhai","fixTextCoord","fixGeoCoord","fixDiaoyuIsland","BoundingRect","DEFAULT_NAME_PROPERTY","GeoJSONResource","mapName","geoJSON","specialAreas","type","_parsedMap","_mapName","_specialAreas","_geoJSON","parseInput","prototype","load","nameMap","nameProperty","parsed","get","rawRegions","_parseToRegions","set","regions","boundingRect","calculateBoundingRect","regionsMap","finalRegions","region","regionName","name","hasOwnProperty","cloneShallow","push","e","Error","message","specialArea","transformTo","left","top","width","height","getMapForUser","geoJson","rect","i","length","regionRect","getBoundingRect","clone","union","source","JSON","parse","Function"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { each, isString, createHashMap } from 'zrender/lib/core/util';\nimport parseGeoJson from './parseGeoJson'; // Built-in GEO fixer.\n\nimport fixNanhai from './fix/nanhai';\nimport fixTextCoord from './fix/textCoord';\nimport fixGeoCoord from './fix/geoCoord';\nimport fixDiaoyuIsland from './fix/diaoyuIsland';\nimport BoundingRect from 'zrender/lib/core/BoundingRect';\nvar DEFAULT_NAME_PROPERTY = 'name';\n\nvar GeoJSONResource =\n/** @class */\nfunction () {\n  function GeoJSONResource(mapName, geoJSON, specialAreas) {\n    this.type = 'geoJSON';\n    this._parsedMap = createHashMap();\n    this._mapName = mapName;\n    this._specialAreas = specialAreas; // PENDING: delay the parse to the first usage to rapid up the FMP?\n\n    this._geoJSON = parseInput(geoJSON);\n  }\n  /**\n   * @param nameMap can be null/undefined\n   * @param nameProperty can be null/undefined\n   */\n\n\n  GeoJSONResource.prototype.load = function (nameMap, nameProperty) {\n    nameProperty = nameProperty || DEFAULT_NAME_PROPERTY;\n\n    var parsed = this._parsedMap.get(nameProperty);\n\n    if (!parsed) {\n      var rawRegions = this._parseToRegions(nameProperty);\n\n      parsed = this._parsedMap.set(nameProperty, {\n        regions: rawRegions,\n        boundingRect: calculateBoundingRect(rawRegions)\n      });\n    }\n\n    var regionsMap = createHashMap();\n    var finalRegions = [];\n    each(parsed.regions, function (region) {\n      var regionName = region.name; // Try use the alias in geoNameMap\n\n      if (nameMap && nameMap.hasOwnProperty(regionName)) {\n        region = region.cloneShallow(regionName = nameMap[regionName]);\n      }\n\n      finalRegions.push(region);\n      regionsMap.set(regionName, region);\n    });\n    return {\n      regions: finalRegions,\n      boundingRect: parsed.boundingRect || new BoundingRect(0, 0, 0, 0),\n      regionsMap: regionsMap\n    };\n  };\n\n  GeoJSONResource.prototype._parseToRegions = function (nameProperty) {\n    var mapName = this._mapName;\n    var geoJSON = this._geoJSON;\n    var rawRegions; // https://jsperf.com/try-catch-performance-overhead\n\n    try {\n      rawRegions = geoJSON ? parseGeoJson(geoJSON, nameProperty) : [];\n    } catch (e) {\n      throw new Error('Invalid geoJson format\\n' + e.message);\n    }\n\n    fixNanhai(mapName, rawRegions);\n    each(rawRegions, function (region) {\n      var regionName = region.name;\n      fixTextCoord(mapName, region);\n      fixGeoCoord(mapName, region);\n      fixDiaoyuIsland(mapName, region); // Some area like Alaska in USA map needs to be tansformed\n      // to look better\n\n      var specialArea = this._specialAreas && this._specialAreas[regionName];\n\n      if (specialArea) {\n        region.transformTo(specialArea.left, specialArea.top, specialArea.width, specialArea.height);\n      }\n    }, this);\n    return rawRegions;\n  };\n  /**\n   * Only for exporting to users.\n   * **MUST NOT** used internally.\n   */\n\n\n  GeoJSONResource.prototype.getMapForUser = function () {\n    return {\n      // For backward compatibility, use geoJson\n      // PENDING: it has been returning them without clone.\n      // do we need to avoid outsite modification?\n      geoJson: this._geoJSON,\n      geoJSON: this._geoJSON,\n      specialAreas: this._specialAreas\n    };\n  };\n\n  return GeoJSONResource;\n}();\n\nexport { GeoJSONResource };\n\nfunction calculateBoundingRect(regions) {\n  var rect;\n\n  for (var i = 0; i < regions.length; i++) {\n    var regionRect = regions[i].getBoundingRect();\n    rect = rect || regionRect.clone();\n    rect.union(regionRect);\n  }\n\n  return rect;\n}\n\nfunction parseInput(source) {\n  return !isString(source) ? source : typeof JSON !== 'undefined' && JSON.parse ? JSON.parse(source) : new Function('return (' + source + ');')();\n}"]},"metadata":{},"sourceType":"module"}