{"ast":null,"code":"import env from './env';\nimport { buildTransformer } from './fourPointsTransform';\nvar EVENT_SAVED_PROP = '___zrEVENTSAVED';\nvar _calcOut = [];\nexport function transformLocalCoord(out, elFrom, elTarget, inX, inY) {\n  return transformCoordWithViewport(_calcOut, elFrom, inX, inY, true) && transformCoordWithViewport(out, elTarget, _calcOut[0], _calcOut[1]);\n}\nexport function transformCoordWithViewport(out, el, inX, inY, inverse) {\n  if (el.getBoundingClientRect && env.domSupported && !isCanvasEl(el)) {\n    var saved = el[EVENT_SAVED_PROP] || (el[EVENT_SAVED_PROP] = {});\n    var markers = prepareCoordMarkers(el, saved);\n    var transformer = preparePointerTransformer(markers, saved, inverse);\n\n    if (transformer) {\n      transformer(out, inX, inY);\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction prepareCoordMarkers(el, saved) {\n  var markers = saved.markers;\n\n  if (markers) {\n    return markers;\n  }\n\n  markers = saved.markers = [];\n  var propLR = ['left', 'right'];\n  var propTB = ['top', 'bottom'];\n\n  for (var i = 0; i < 4; i++) {\n    var marker = document.createElement('div');\n    var stl = marker.style;\n    var idxLR = i % 2;\n    var idxTB = (i >> 1) % 2;\n    stl.cssText = ['position: absolute', 'visibility: hidden', 'padding: 0', 'margin: 0', 'border-width: 0', 'user-select: none', 'width:0', 'height:0', propLR[idxLR] + ':0', propTB[idxTB] + ':0', propLR[1 - idxLR] + ':auto', propTB[1 - idxTB] + ':auto', ''].join('!important;');\n    el.appendChild(marker);\n    markers.push(marker);\n  }\n\n  return markers;\n}\n\nfunction preparePointerTransformer(markers, saved, inverse) {\n  var transformerName = inverse ? 'invTrans' : 'trans';\n  var transformer = saved[transformerName];\n  var oldSrcCoords = saved.srcCoords;\n  var srcCoords = [];\n  var destCoords = [];\n  var oldCoordTheSame = true;\n\n  for (var i = 0; i < 4; i++) {\n    var rect = markers[i].getBoundingClientRect();\n    var ii = 2 * i;\n    var x = rect.left;\n    var y = rect.top;\n    srcCoords.push(x, y);\n    oldCoordTheSame = oldCoordTheSame && oldSrcCoords && x === oldSrcCoords[ii] && y === oldSrcCoords[ii + 1];\n    destCoords.push(markers[i].offsetLeft, markers[i].offsetTop);\n  }\n\n  return oldCoordTheSame && transformer ? transformer : (saved.srcCoords = srcCoords, saved[transformerName] = inverse ? buildTransformer(destCoords, srcCoords) : buildTransformer(srcCoords, destCoords));\n}\n\nexport function isCanvasEl(el) {\n  return el.nodeName.toUpperCase() === 'CANVAS';\n}","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/zrender/lib/core/dom.js"],"names":["env","buildTransformer","EVENT_SAVED_PROP","_calcOut","transformLocalCoord","out","elFrom","elTarget","inX","inY","transformCoordWithViewport","el","inverse","getBoundingClientRect","domSupported","isCanvasEl","saved","markers","prepareCoordMarkers","transformer","preparePointerTransformer","propLR","propTB","i","marker","document","createElement","stl","style","idxLR","idxTB","cssText","join","appendChild","push","transformerName","oldSrcCoords","srcCoords","destCoords","oldCoordTheSame","rect","ii","x","left","y","top","offsetLeft","offsetTop","nodeName","toUpperCase"],"mappings":"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","sourcesContent":["import env from './env';\nimport { buildTransformer } from './fourPointsTransform';\nvar EVENT_SAVED_PROP = '___zrEVENTSAVED';\nvar _calcOut = [];\nexport function transformLocalCoord(out, elFrom, elTarget, inX, inY) {\n    return transformCoordWithViewport(_calcOut, elFrom, inX, inY, true)\n        && transformCoordWithViewport(out, elTarget, _calcOut[0], _calcOut[1]);\n}\nexport function transformCoordWithViewport(out, el, inX, inY, inverse) {\n    if (el.getBoundingClientRect && env.domSupported && !isCanvasEl(el)) {\n        var saved = el[EVENT_SAVED_PROP] || (el[EVENT_SAVED_PROP] = {});\n        var markers = prepareCoordMarkers(el, saved);\n        var transformer = preparePointerTransformer(markers, saved, inverse);\n        if (transformer) {\n            transformer(out, inX, inY);\n            return true;\n        }\n    }\n    return false;\n}\nfunction prepareCoordMarkers(el, saved) {\n    var markers = saved.markers;\n    if (markers) {\n        return markers;\n    }\n    markers = saved.markers = [];\n    var propLR = ['left', 'right'];\n    var propTB = ['top', 'bottom'];\n    for (var i = 0; i < 4; i++) {\n        var marker = document.createElement('div');\n        var stl = marker.style;\n        var idxLR = i % 2;\n        var idxTB = (i >> 1) % 2;\n        stl.cssText = [\n            'position: absolute',\n            'visibility: hidden',\n            'padding: 0',\n            'margin: 0',\n            'border-width: 0',\n            'user-select: none',\n            'width:0',\n            'height:0',\n            propLR[idxLR] + ':0',\n            propTB[idxTB] + ':0',\n            propLR[1 - idxLR] + ':auto',\n            propTB[1 - idxTB] + ':auto',\n            ''\n        ].join('!important;');\n        el.appendChild(marker);\n        markers.push(marker);\n    }\n    return markers;\n}\nfunction preparePointerTransformer(markers, saved, inverse) {\n    var transformerName = inverse ? 'invTrans' : 'trans';\n    var transformer = saved[transformerName];\n    var oldSrcCoords = saved.srcCoords;\n    var srcCoords = [];\n    var destCoords = [];\n    var oldCoordTheSame = true;\n    for (var i = 0; i < 4; i++) {\n        var rect = markers[i].getBoundingClientRect();\n        var ii = 2 * i;\n        var x = rect.left;\n        var y = rect.top;\n        srcCoords.push(x, y);\n        oldCoordTheSame = oldCoordTheSame && oldSrcCoords && x === oldSrcCoords[ii] && y === oldSrcCoords[ii + 1];\n        destCoords.push(markers[i].offsetLeft, markers[i].offsetTop);\n    }\n    return (oldCoordTheSame && transformer)\n        ? transformer\n        : (saved.srcCoords = srcCoords,\n            saved[transformerName] = inverse\n                ? buildTransformer(destCoords, srcCoords)\n                : buildTransformer(srcCoords, destCoords));\n}\nexport function isCanvasEl(el) {\n    return el.nodeName.toUpperCase() === 'CANVAS';\n}\n"]},"metadata":{},"sourceType":"module"}