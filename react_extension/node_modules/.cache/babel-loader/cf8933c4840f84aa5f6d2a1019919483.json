{"ast":null,"code":"import * as util from './core/util';\nimport env from './core/env';\nimport timsort from './core/timsort';\nimport { REDARAW_BIT } from './graphic/constants';\nvar invalidZErrorLogged = false;\n\nfunction logInvalidZError() {\n  if (invalidZErrorLogged) {\n    return;\n  }\n\n  invalidZErrorLogged = true;\n  console.warn('z / z2 / zlevel of displayable is invalid, which may cause unexpected errors');\n}\n\nfunction shapeCompareFunc(a, b) {\n  if (a.zlevel === b.zlevel) {\n    if (a.z === b.z) {\n      return a.z2 - b.z2;\n    }\n\n    return a.z - b.z;\n  }\n\n  return a.zlevel - b.zlevel;\n}\n\nvar Storage = function () {\n  function Storage() {\n    this._roots = [];\n    this._displayList = [];\n    this._displayListLen = 0;\n    this.displayableSortFunc = shapeCompareFunc;\n  }\n\n  Storage.prototype.traverse = function (cb, context) {\n    for (var i = 0; i < this._roots.length; i++) {\n      this._roots[i].traverse(cb, context);\n    }\n  };\n\n  Storage.prototype.getDisplayList = function (update, includeIgnore) {\n    includeIgnore = includeIgnore || false;\n    var displayList = this._displayList;\n\n    if (update || !displayList.length) {\n      this.updateDisplayList(includeIgnore);\n    }\n\n    return displayList;\n  };\n\n  Storage.prototype.updateDisplayList = function (includeIgnore) {\n    this._displayListLen = 0;\n    var roots = this._roots;\n    var displayList = this._displayList;\n\n    for (var i = 0, len = roots.length; i < len; i++) {\n      this._updateAndAddDisplayable(roots[i], null, includeIgnore);\n    }\n\n    displayList.length = this._displayListLen;\n    env.canvasSupported && timsort(displayList, shapeCompareFunc);\n  };\n\n  Storage.prototype._updateAndAddDisplayable = function (el, clipPaths, includeIgnore) {\n    if (el.ignore && !includeIgnore) {\n      return;\n    }\n\n    el.beforeUpdate();\n    el.update();\n    el.afterUpdate();\n    var userSetClipPath = el.getClipPath();\n\n    if (el.ignoreClip) {\n      clipPaths = null;\n    } else if (userSetClipPath) {\n      if (clipPaths) {\n        clipPaths = clipPaths.slice();\n      } else {\n        clipPaths = [];\n      }\n\n      var currentClipPath = userSetClipPath;\n      var parentClipPath = el;\n\n      while (currentClipPath) {\n        currentClipPath.parent = parentClipPath;\n        currentClipPath.updateTransform();\n        clipPaths.push(currentClipPath);\n        parentClipPath = currentClipPath;\n        currentClipPath = currentClipPath.getClipPath();\n      }\n    }\n\n    if (el.childrenRef) {\n      var children = el.childrenRef();\n\n      for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n\n        if (el.__dirty) {\n          child.__dirty |= REDARAW_BIT;\n        }\n\n        this._updateAndAddDisplayable(child, clipPaths, includeIgnore);\n      }\n\n      el.__dirty = 0;\n    } else {\n      var disp = el;\n\n      if (clipPaths && clipPaths.length) {\n        disp.__clipPaths = clipPaths;\n      } else if (disp.__clipPaths && disp.__clipPaths.length > 0) {\n        disp.__clipPaths = [];\n      }\n\n      if (isNaN(disp.z)) {\n        logInvalidZError();\n        disp.z = 0;\n      }\n\n      if (isNaN(disp.z2)) {\n        logInvalidZError();\n        disp.z2 = 0;\n      }\n\n      if (isNaN(disp.zlevel)) {\n        logInvalidZError();\n        disp.zlevel = 0;\n      }\n\n      this._displayList[this._displayListLen++] = disp;\n    }\n\n    var decalEl = el.getDecalElement && el.getDecalElement();\n\n    if (decalEl) {\n      this._updateAndAddDisplayable(decalEl, clipPaths, includeIgnore);\n    }\n\n    var textGuide = el.getTextGuideLine();\n\n    if (textGuide) {\n      this._updateAndAddDisplayable(textGuide, clipPaths, includeIgnore);\n    }\n\n    var textEl = el.getTextContent();\n\n    if (textEl) {\n      this._updateAndAddDisplayable(textEl, clipPaths, includeIgnore);\n    }\n  };\n\n  Storage.prototype.addRoot = function (el) {\n    if (el.__zr && el.__zr.storage === this) {\n      return;\n    }\n\n    this._roots.push(el);\n  };\n\n  Storage.prototype.delRoot = function (el) {\n    if (el instanceof Array) {\n      for (var i = 0, l = el.length; i < l; i++) {\n        this.delRoot(el[i]);\n      }\n\n      return;\n    }\n\n    var idx = util.indexOf(this._roots, el);\n\n    if (idx >= 0) {\n      this._roots.splice(idx, 1);\n    }\n  };\n\n  Storage.prototype.delAllRoots = function () {\n    this._roots = [];\n    this._displayList = [];\n    this._displayListLen = 0;\n    return;\n  };\n\n  Storage.prototype.getRoots = function () {\n    return this._roots;\n  };\n\n  Storage.prototype.dispose = function () {\n    this._displayList = null;\n    this._roots = null;\n  };\n\n  return Storage;\n}();\n\nexport default Storage;","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/zrender/lib/Storage.js"],"names":["util","env","timsort","REDARAW_BIT","invalidZErrorLogged","logInvalidZError","console","warn","shapeCompareFunc","a","b","zlevel","z","z2","Storage","_roots","_displayList","_displayListLen","displayableSortFunc","prototype","traverse","cb","context","i","length","getDisplayList","update","includeIgnore","displayList","updateDisplayList","roots","len","_updateAndAddDisplayable","canvasSupported","el","clipPaths","ignore","beforeUpdate","afterUpdate","userSetClipPath","getClipPath","ignoreClip","slice","currentClipPath","parentClipPath","parent","updateTransform","push","childrenRef","children","child","__dirty","disp","__clipPaths","isNaN","decalEl","getDecalElement","textGuide","getTextGuideLine","textEl","getTextContent","addRoot","__zr","storage","delRoot","Array","l","idx","indexOf","splice","delAllRoots","getRoots","dispose"],"mappings":"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","sourcesContent":["import * as util from './core/util';\nimport env from './core/env';\nimport timsort from './core/timsort';\nimport { REDARAW_BIT } from './graphic/constants';\nvar invalidZErrorLogged = false;\nfunction logInvalidZError() {\n    if (invalidZErrorLogged) {\n        return;\n    }\n    invalidZErrorLogged = true;\n    console.warn('z / z2 / zlevel of displayable is invalid, which may cause unexpected errors');\n}\nfunction shapeCompareFunc(a, b) {\n    if (a.zlevel === b.zlevel) {\n        if (a.z === b.z) {\n            return a.z2 - b.z2;\n        }\n        return a.z - b.z;\n    }\n    return a.zlevel - b.zlevel;\n}\nvar Storage = (function () {\n    function Storage() {\n        this._roots = [];\n        this._displayList = [];\n        this._displayListLen = 0;\n        this.displayableSortFunc = shapeCompareFunc;\n    }\n    Storage.prototype.traverse = function (cb, context) {\n        for (var i = 0; i < this._roots.length; i++) {\n            this._roots[i].traverse(cb, context);\n        }\n    };\n    Storage.prototype.getDisplayList = function (update, includeIgnore) {\n        includeIgnore = includeIgnore || false;\n        var displayList = this._displayList;\n        if (update || !displayList.length) {\n            this.updateDisplayList(includeIgnore);\n        }\n        return displayList;\n    };\n    Storage.prototype.updateDisplayList = function (includeIgnore) {\n        this._displayListLen = 0;\n        var roots = this._roots;\n        var displayList = this._displayList;\n        for (var i = 0, len = roots.length; i < len; i++) {\n            this._updateAndAddDisplayable(roots[i], null, includeIgnore);\n        }\n        displayList.length = this._displayListLen;\n        env.canvasSupported && timsort(displayList, shapeCompareFunc);\n    };\n    Storage.prototype._updateAndAddDisplayable = function (el, clipPaths, includeIgnore) {\n        if (el.ignore && !includeIgnore) {\n            return;\n        }\n        el.beforeUpdate();\n        el.update();\n        el.afterUpdate();\n        var userSetClipPath = el.getClipPath();\n        if (el.ignoreClip) {\n            clipPaths = null;\n        }\n        else if (userSetClipPath) {\n            if (clipPaths) {\n                clipPaths = clipPaths.slice();\n            }\n            else {\n                clipPaths = [];\n            }\n            var currentClipPath = userSetClipPath;\n            var parentClipPath = el;\n            while (currentClipPath) {\n                currentClipPath.parent = parentClipPath;\n                currentClipPath.updateTransform();\n                clipPaths.push(currentClipPath);\n                parentClipPath = currentClipPath;\n                currentClipPath = currentClipPath.getClipPath();\n            }\n        }\n        if (el.childrenRef) {\n            var children = el.childrenRef();\n            for (var i = 0; i < children.length; i++) {\n                var child = children[i];\n                if (el.__dirty) {\n                    child.__dirty |= REDARAW_BIT;\n                }\n                this._updateAndAddDisplayable(child, clipPaths, includeIgnore);\n            }\n            el.__dirty = 0;\n        }\n        else {\n            var disp = el;\n            if (clipPaths && clipPaths.length) {\n                disp.__clipPaths = clipPaths;\n            }\n            else if (disp.__clipPaths && disp.__clipPaths.length > 0) {\n                disp.__clipPaths = [];\n            }\n            if (isNaN(disp.z)) {\n                logInvalidZError();\n                disp.z = 0;\n            }\n            if (isNaN(disp.z2)) {\n                logInvalidZError();\n                disp.z2 = 0;\n            }\n            if (isNaN(disp.zlevel)) {\n                logInvalidZError();\n                disp.zlevel = 0;\n            }\n            this._displayList[this._displayListLen++] = disp;\n        }\n        var decalEl = el.getDecalElement && el.getDecalElement();\n        if (decalEl) {\n            this._updateAndAddDisplayable(decalEl, clipPaths, includeIgnore);\n        }\n        var textGuide = el.getTextGuideLine();\n        if (textGuide) {\n            this._updateAndAddDisplayable(textGuide, clipPaths, includeIgnore);\n        }\n        var textEl = el.getTextContent();\n        if (textEl) {\n            this._updateAndAddDisplayable(textEl, clipPaths, includeIgnore);\n        }\n    };\n    Storage.prototype.addRoot = function (el) {\n        if (el.__zr && el.__zr.storage === this) {\n            return;\n        }\n        this._roots.push(el);\n    };\n    Storage.prototype.delRoot = function (el) {\n        if (el instanceof Array) {\n            for (var i = 0, l = el.length; i < l; i++) {\n                this.delRoot(el[i]);\n            }\n            return;\n        }\n        var idx = util.indexOf(this._roots, el);\n        if (idx >= 0) {\n            this._roots.splice(idx, 1);\n        }\n    };\n    Storage.prototype.delAllRoots = function () {\n        this._roots = [];\n        this._displayList = [];\n        this._displayListLen = 0;\n        return;\n    };\n    Storage.prototype.getRoots = function () {\n        return this._roots;\n    };\n    Storage.prototype.dispose = function () {\n        this._displayList = null;\n        this._roots = null;\n    };\n    return Storage;\n}());\nexport default Storage;\n"]},"metadata":{},"sourceType":"module"}