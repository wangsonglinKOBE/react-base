{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// Only create one roam controller for each coordinate system.\n// one roam controller might be refered by two inside data zoom\n// components (for example, one for x and one for y). When user\n// pan or zoom, only dispatch one action for those data zoom\n// components.\nimport RoamController from '../../component/helper/RoamController';\nimport * as throttleUtil from '../../util/throttle';\nimport { makeInner } from '../../util/model';\nimport { each, curry, createHashMap } from 'zrender/lib/core/util';\nimport { collectReferCoordSysModelInfo } from './helper';\nvar inner = makeInner();\nexport function setViewInfoToCoordSysRecord(api, dataZoomModel, getRange) {\n  inner(api).coordSysRecordMap.each(function (coordSysRecord) {\n    var dzInfo = coordSysRecord.dataZoomInfoMap.get(dataZoomModel.uid);\n\n    if (dzInfo) {\n      dzInfo.getRange = getRange;\n    }\n  });\n}\nexport function disposeCoordSysRecordIfNeeded(api, dataZoomModel) {\n  var coordSysRecordMap = inner(api).coordSysRecordMap;\n  var coordSysKeyArr = coordSysRecordMap.keys();\n\n  for (var i = 0; i < coordSysKeyArr.length; i++) {\n    var coordSysKey = coordSysKeyArr[i];\n    var coordSysRecord = coordSysRecordMap.get(coordSysKey);\n    var dataZoomInfoMap = coordSysRecord.dataZoomInfoMap;\n\n    if (dataZoomInfoMap) {\n      var dzUid = dataZoomModel.uid;\n      var dzInfo = dataZoomInfoMap.get(dzUid);\n\n      if (dzInfo) {\n        dataZoomInfoMap.removeKey(dzUid);\n\n        if (!dataZoomInfoMap.keys().length) {\n          disposeCoordSysRecord(coordSysRecordMap, coordSysRecord);\n        }\n      }\n    }\n  }\n}\n\nfunction disposeCoordSysRecord(coordSysRecordMap, coordSysRecord) {\n  if (coordSysRecord) {\n    coordSysRecordMap.removeKey(coordSysRecord.model.uid);\n    var controller = coordSysRecord.controller;\n    controller && controller.dispose();\n  }\n}\n\nfunction createCoordSysRecord(api, coordSysModel) {\n  // These init props will never change after record created.\n  var coordSysRecord = {\n    model: coordSysModel,\n    containsPoint: curry(containsPoint, coordSysModel),\n    dispatchAction: curry(dispatchAction, api),\n    dataZoomInfoMap: null,\n    controller: null\n  }; // Must not do anything depends on coordSysRecord outside the event handler here,\n  // because coordSysRecord not completed yet.\n\n  var controller = coordSysRecord.controller = new RoamController(api.getZr());\n  each(['pan', 'zoom', 'scrollMove'], function (eventName) {\n    controller.on(eventName, function (event) {\n      var batch = [];\n      coordSysRecord.dataZoomInfoMap.each(function (dzInfo) {\n        // Check whether the behaviors (zoomOnMouseWheel, moveOnMouseMove,\n        // moveOnMouseWheel, ...) enabled.\n        if (!event.isAvailableBehavior(dzInfo.model.option)) {\n          return;\n        }\n\n        var method = (dzInfo.getRange || {})[eventName];\n        var range = method && method(dzInfo.dzReferCoordSysInfo, coordSysRecord.model.mainType, coordSysRecord.controller, event);\n        !dzInfo.model.get('disabled', true) && range && batch.push({\n          dataZoomId: dzInfo.model.id,\n          start: range[0],\n          end: range[1]\n        });\n      });\n      batch.length && coordSysRecord.dispatchAction(batch);\n    });\n  });\n  return coordSysRecord;\n}\n/**\n * This action will be throttled.\n */\n\n\nfunction dispatchAction(api, batch) {\n  api.dispatchAction({\n    type: 'dataZoom',\n    animation: {\n      easing: 'cubicOut',\n      duration: 100\n    },\n    batch: batch\n  });\n}\n\nfunction containsPoint(coordSysModel, e, x, y) {\n  return coordSysModel.coordinateSystem.containPoint([x, y]);\n}\n/**\n * Merge roamController settings when multiple dataZooms share one roamController.\n */\n\n\nfunction mergeControllerParams(dataZoomInfoMap) {\n  var controlType; // DO NOT use reserved word (true, false, undefined) as key literally. Even if encapsulated\n  // as string, it is probably revert to reserved word by compress tool. See #7411.\n\n  var prefix = 'type_';\n  var typePriority = {\n    'type_true': 2,\n    'type_move': 1,\n    'type_false': 0,\n    'type_undefined': -1\n  };\n  var preventDefaultMouseMove = true;\n  dataZoomInfoMap.each(function (dataZoomInfo) {\n    var dataZoomModel = dataZoomInfo.model;\n    var oneType = dataZoomModel.get('disabled', true) ? false : dataZoomModel.get('zoomLock', true) ? 'move' : true;\n\n    if (typePriority[prefix + oneType] > typePriority[prefix + controlType]) {\n      controlType = oneType;\n    } // Prevent default move event by default. If one false, do not prevent. Otherwise\n    // users may be confused why it does not work when multiple insideZooms exist.\n\n\n    preventDefaultMouseMove = preventDefaultMouseMove && dataZoomModel.get('preventDefaultMouseMove', true);\n  });\n  return {\n    controlType: controlType,\n    opt: {\n      // RoamController will enable all of these functionalities,\n      // and the final behavior is determined by its event listener\n      // provided by each inside zoom.\n      zoomOnMouseWheel: true,\n      moveOnMouseMove: true,\n      moveOnMouseWheel: true,\n      preventDefaultMouseMove: !!preventDefaultMouseMove\n    }\n  };\n}\n\nexport function installDataZoomRoamProcessor(registers) {\n  registers.registerProcessor(registers.PRIORITY.PROCESSOR.FILTER, function (ecModel, api) {\n    var apiInner = inner(api);\n    var coordSysRecordMap = apiInner.coordSysRecordMap || (apiInner.coordSysRecordMap = createHashMap());\n    coordSysRecordMap.each(function (coordSysRecord) {\n      // `coordSysRecordMap` always exists (becuase it hold the `roam controller`, which should\n      // better not re-create each time), but clear `dataZoomInfoMap` each round of the workflow.\n      coordSysRecord.dataZoomInfoMap = null;\n    });\n    ecModel.eachComponent({\n      mainType: 'dataZoom',\n      subType: 'inside'\n    }, function (dataZoomModel) {\n      var dzReferCoordSysWrap = collectReferCoordSysModelInfo(dataZoomModel);\n      each(dzReferCoordSysWrap.infoList, function (dzCoordSysInfo) {\n        var coordSysUid = dzCoordSysInfo.model.uid;\n        var coordSysRecord = coordSysRecordMap.get(coordSysUid) || coordSysRecordMap.set(coordSysUid, createCoordSysRecord(api, dzCoordSysInfo.model));\n        var dataZoomInfoMap = coordSysRecord.dataZoomInfoMap || (coordSysRecord.dataZoomInfoMap = createHashMap()); // Notice these props might be changed each time for a single dataZoomModel.\n\n        dataZoomInfoMap.set(dataZoomModel.uid, {\n          dzReferCoordSysInfo: dzCoordSysInfo,\n          model: dataZoomModel,\n          getRange: null\n        });\n      });\n    }); // (1) Merge dataZoom settings for each coord sys and set to the roam controller.\n    // (2) Clear coord sys if not refered by any dataZoom.\n\n    coordSysRecordMap.each(function (coordSysRecord) {\n      var controller = coordSysRecord.controller;\n      var firstDzInfo;\n      var dataZoomInfoMap = coordSysRecord.dataZoomInfoMap;\n\n      if (dataZoomInfoMap) {\n        var firstDzKey = dataZoomInfoMap.keys()[0];\n\n        if (firstDzKey != null) {\n          firstDzInfo = dataZoomInfoMap.get(firstDzKey);\n        }\n      }\n\n      if (!firstDzInfo) {\n        disposeCoordSysRecord(coordSysRecordMap, coordSysRecord);\n        return;\n      }\n\n      var controllerParams = mergeControllerParams(dataZoomInfoMap);\n      controller.enable(controllerParams.controlType, controllerParams.opt);\n      controller.setPointerChecker(coordSysRecord.containsPoint);\n      throttleUtil.createOrUpdate(coordSysRecord, 'dispatchAction', firstDzInfo.model.get('throttle', true), 'fixRate');\n    });\n  });\n}","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/echarts/lib/component/dataZoom/roams.js"],"names":["RoamController","throttleUtil","makeInner","each","curry","createHashMap","collectReferCoordSysModelInfo","inner","setViewInfoToCoordSysRecord","api","dataZoomModel","getRange","coordSysRecordMap","coordSysRecord","dzInfo","dataZoomInfoMap","get","uid","disposeCoordSysRecordIfNeeded","coordSysKeyArr","keys","i","length","coordSysKey","dzUid","removeKey","disposeCoordSysRecord","model","controller","dispose","createCoordSysRecord","coordSysModel","containsPoint","dispatchAction","getZr","eventName","on","event","batch","isAvailableBehavior","option","method","range","dzReferCoordSysInfo","mainType","push","dataZoomId","id","start","end","type","animation","easing","duration","e","x","y","coordinateSystem","containPoint","mergeControllerParams","controlType","prefix","typePriority","preventDefaultMouseMove","dataZoomInfo","oneType","opt","zoomOnMouseWheel","moveOnMouseMove","moveOnMouseWheel","installDataZoomRoamProcessor","registers","registerProcessor","PRIORITY","PROCESSOR","FILTER","ecModel","apiInner","eachComponent","subType","dzReferCoordSysWrap","infoList","dzCoordSysInfo","coordSysUid","set","firstDzInfo","firstDzKey","controllerParams","enable","setPointerChecker","createOrUpdate"],"mappings":"AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,cAAP,MAA2B,uCAA3B;AACA,OAAO,KAAKC,YAAZ,MAA8B,qBAA9B;AACA,SAASC,SAAT,QAA0B,kBAA1B;AACA,SAASC,IAAT,EAAeC,KAAf,EAAsBC,aAAtB,QAA2C,uBAA3C;AACA,SAASC,6BAAT,QAA8C,UAA9C;AACA,IAAIC,KAAK,GAAGL,SAAS,EAArB;AACA,OAAO,SAASM,2BAAT,CAAqCC,GAArC,EAA0CC,aAA1C,EAAyDC,QAAzD,EAAmE;AACxEJ,EAAAA,KAAK,CAACE,GAAD,CAAL,CAAWG,iBAAX,CAA6BT,IAA7B,CAAkC,UAAUU,cAAV,EAA0B;AAC1D,QAAIC,MAAM,GAAGD,cAAc,CAACE,eAAf,CAA+BC,GAA/B,CAAmCN,aAAa,CAACO,GAAjD,CAAb;;AAEA,QAAIH,MAAJ,EAAY;AACVA,MAAAA,MAAM,CAACH,QAAP,GAAkBA,QAAlB;AACD;AACF,GAND;AAOD;AACD,OAAO,SAASO,6BAAT,CAAuCT,GAAvC,EAA4CC,aAA5C,EAA2D;AAChE,MAAIE,iBAAiB,GAAGL,KAAK,CAACE,GAAD,CAAL,CAAWG,iBAAnC;AACA,MAAIO,cAAc,GAAGP,iBAAiB,CAACQ,IAAlB,EAArB;;AAEA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,cAAc,CAACG,MAAnC,EAA2CD,CAAC,EAA5C,EAAgD;AAC9C,QAAIE,WAAW,GAAGJ,cAAc,CAACE,CAAD,CAAhC;AACA,QAAIR,cAAc,GAAGD,iBAAiB,CAACI,GAAlB,CAAsBO,WAAtB,CAArB;AACA,QAAIR,eAAe,GAAGF,cAAc,CAACE,eAArC;;AAEA,QAAIA,eAAJ,EAAqB;AACnB,UAAIS,KAAK,GAAGd,aAAa,CAACO,GAA1B;AACA,UAAIH,MAAM,GAAGC,eAAe,CAACC,GAAhB,CAAoBQ,KAApB,CAAb;;AAEA,UAAIV,MAAJ,EAAY;AACVC,QAAAA,eAAe,CAACU,SAAhB,CAA0BD,KAA1B;;AAEA,YAAI,CAACT,eAAe,CAACK,IAAhB,GAAuBE,MAA5B,EAAoC;AAClCI,UAAAA,qBAAqB,CAACd,iBAAD,EAAoBC,cAApB,CAArB;AACD;AACF;AACF;AACF;AACF;;AAED,SAASa,qBAAT,CAA+Bd,iBAA/B,EAAkDC,cAAlD,EAAkE;AAChE,MAAIA,cAAJ,EAAoB;AAClBD,IAAAA,iBAAiB,CAACa,SAAlB,CAA4BZ,cAAc,CAACc,KAAf,CAAqBV,GAAjD;AACA,QAAIW,UAAU,GAAGf,cAAc,CAACe,UAAhC;AACAA,IAAAA,UAAU,IAAIA,UAAU,CAACC,OAAX,EAAd;AACD;AACF;;AAED,SAASC,oBAAT,CAA8BrB,GAA9B,EAAmCsB,aAAnC,EAAkD;AAChD;AACA,MAAIlB,cAAc,GAAG;AACnBc,IAAAA,KAAK,EAAEI,aADY;AAEnBC,IAAAA,aAAa,EAAE5B,KAAK,CAAC4B,aAAD,EAAgBD,aAAhB,CAFD;AAGnBE,IAAAA,cAAc,EAAE7B,KAAK,CAAC6B,cAAD,EAAiBxB,GAAjB,CAHF;AAInBM,IAAAA,eAAe,EAAE,IAJE;AAKnBa,IAAAA,UAAU,EAAE;AALO,GAArB,CAFgD,CAQ7C;AACH;;AAEA,MAAIA,UAAU,GAAGf,cAAc,CAACe,UAAf,GAA4B,IAAI5B,cAAJ,CAAmBS,GAAG,CAACyB,KAAJ,EAAnB,CAA7C;AACA/B,EAAAA,IAAI,CAAC,CAAC,KAAD,EAAQ,MAAR,EAAgB,YAAhB,CAAD,EAAgC,UAAUgC,SAAV,EAAqB;AACvDP,IAAAA,UAAU,CAACQ,EAAX,CAAcD,SAAd,EAAyB,UAAUE,KAAV,EAAiB;AACxC,UAAIC,KAAK,GAAG,EAAZ;AACAzB,MAAAA,cAAc,CAACE,eAAf,CAA+BZ,IAA/B,CAAoC,UAAUW,MAAV,EAAkB;AACpD;AACA;AACA,YAAI,CAACuB,KAAK,CAACE,mBAAN,CAA0BzB,MAAM,CAACa,KAAP,CAAaa,MAAvC,CAAL,EAAqD;AACnD;AACD;;AAED,YAAIC,MAAM,GAAG,CAAC3B,MAAM,CAACH,QAAP,IAAmB,EAApB,EAAwBwB,SAAxB,CAAb;AACA,YAAIO,KAAK,GAAGD,MAAM,IAAIA,MAAM,CAAC3B,MAAM,CAAC6B,mBAAR,EAA6B9B,cAAc,CAACc,KAAf,CAAqBiB,QAAlD,EAA4D/B,cAAc,CAACe,UAA3E,EAAuFS,KAAvF,CAA5B;AACA,SAACvB,MAAM,CAACa,KAAP,CAAaX,GAAb,CAAiB,UAAjB,EAA6B,IAA7B,CAAD,IAAuC0B,KAAvC,IAAgDJ,KAAK,CAACO,IAAN,CAAW;AACzDC,UAAAA,UAAU,EAAEhC,MAAM,CAACa,KAAP,CAAaoB,EADgC;AAEzDC,UAAAA,KAAK,EAAEN,KAAK,CAAC,CAAD,CAF6C;AAGzDO,UAAAA,GAAG,EAAEP,KAAK,CAAC,CAAD;AAH+C,SAAX,CAAhD;AAKD,OAdD;AAeAJ,MAAAA,KAAK,CAAChB,MAAN,IAAgBT,cAAc,CAACoB,cAAf,CAA8BK,KAA9B,CAAhB;AACD,KAlBD;AAmBD,GApBG,CAAJ;AAqBA,SAAOzB,cAAP;AACD;AACD;AACA;AACA;;;AAGA,SAASoB,cAAT,CAAwBxB,GAAxB,EAA6B6B,KAA7B,EAAoC;AAClC7B,EAAAA,GAAG,CAACwB,cAAJ,CAAmB;AACjBiB,IAAAA,IAAI,EAAE,UADW;AAEjBC,IAAAA,SAAS,EAAE;AACTC,MAAAA,MAAM,EAAE,UADC;AAETC,MAAAA,QAAQ,EAAE;AAFD,KAFM;AAMjBf,IAAAA,KAAK,EAAEA;AANU,GAAnB;AAQD;;AAED,SAASN,aAAT,CAAuBD,aAAvB,EAAsCuB,CAAtC,EAAyCC,CAAzC,EAA4CC,CAA5C,EAA+C;AAC7C,SAAOzB,aAAa,CAAC0B,gBAAd,CAA+BC,YAA/B,CAA4C,CAACH,CAAD,EAAIC,CAAJ,CAA5C,CAAP;AACD;AACD;AACA;AACA;;;AAGA,SAASG,qBAAT,CAA+B5C,eAA/B,EAAgD;AAC9C,MAAI6C,WAAJ,CAD8C,CAC7B;AACjB;;AAEA,MAAIC,MAAM,GAAG,OAAb;AACA,MAAIC,YAAY,GAAG;AACjB,iBAAa,CADI;AAEjB,iBAAa,CAFI;AAGjB,kBAAc,CAHG;AAIjB,sBAAkB,CAAC;AAJF,GAAnB;AAMA,MAAIC,uBAAuB,GAAG,IAA9B;AACAhD,EAAAA,eAAe,CAACZ,IAAhB,CAAqB,UAAU6D,YAAV,EAAwB;AAC3C,QAAItD,aAAa,GAAGsD,YAAY,CAACrC,KAAjC;AACA,QAAIsC,OAAO,GAAGvD,aAAa,CAACM,GAAd,CAAkB,UAAlB,EAA8B,IAA9B,IAAsC,KAAtC,GAA8CN,aAAa,CAACM,GAAd,CAAkB,UAAlB,EAA8B,IAA9B,IAAsC,MAAtC,GAA+C,IAA3G;;AAEA,QAAI8C,YAAY,CAACD,MAAM,GAAGI,OAAV,CAAZ,GAAiCH,YAAY,CAACD,MAAM,GAAGD,WAAV,CAAjD,EAAyE;AACvEA,MAAAA,WAAW,GAAGK,OAAd;AACD,KAN0C,CAMzC;AACF;;;AAGAF,IAAAA,uBAAuB,GAAGA,uBAAuB,IAAIrD,aAAa,CAACM,GAAd,CAAkB,yBAAlB,EAA6C,IAA7C,CAArD;AACD,GAXD;AAYA,SAAO;AACL4C,IAAAA,WAAW,EAAEA,WADR;AAELM,IAAAA,GAAG,EAAE;AACH;AACA;AACA;AACAC,MAAAA,gBAAgB,EAAE,IAJf;AAKHC,MAAAA,eAAe,EAAE,IALd;AAMHC,MAAAA,gBAAgB,EAAE,IANf;AAOHN,MAAAA,uBAAuB,EAAE,CAAC,CAACA;AAPxB;AAFA,GAAP;AAYD;;AAED,OAAO,SAASO,4BAAT,CAAsCC,SAAtC,EAAiD;AACtDA,EAAAA,SAAS,CAACC,iBAAV,CAA4BD,SAAS,CAACE,QAAV,CAAmBC,SAAnB,CAA6BC,MAAzD,EAAiE,UAAUC,OAAV,EAAmBnE,GAAnB,EAAwB;AACvF,QAAIoE,QAAQ,GAAGtE,KAAK,CAACE,GAAD,CAApB;AACA,QAAIG,iBAAiB,GAAGiE,QAAQ,CAACjE,iBAAT,KAA+BiE,QAAQ,CAACjE,iBAAT,GAA6BP,aAAa,EAAzE,CAAxB;AACAO,IAAAA,iBAAiB,CAACT,IAAlB,CAAuB,UAAUU,cAAV,EAA0B;AAC/C;AACA;AACAA,MAAAA,cAAc,CAACE,eAAf,GAAiC,IAAjC;AACD,KAJD;AAKA6D,IAAAA,OAAO,CAACE,aAAR,CAAsB;AACpBlC,MAAAA,QAAQ,EAAE,UADU;AAEpBmC,MAAAA,OAAO,EAAE;AAFW,KAAtB,EAGG,UAAUrE,aAAV,EAAyB;AAC1B,UAAIsE,mBAAmB,GAAG1E,6BAA6B,CAACI,aAAD,CAAvD;AACAP,MAAAA,IAAI,CAAC6E,mBAAmB,CAACC,QAArB,EAA+B,UAAUC,cAAV,EAA0B;AAC3D,YAAIC,WAAW,GAAGD,cAAc,CAACvD,KAAf,CAAqBV,GAAvC;AACA,YAAIJ,cAAc,GAAGD,iBAAiB,CAACI,GAAlB,CAAsBmE,WAAtB,KAAsCvE,iBAAiB,CAACwE,GAAlB,CAAsBD,WAAtB,EAAmCrD,oBAAoB,CAACrB,GAAD,EAAMyE,cAAc,CAACvD,KAArB,CAAvD,CAA3D;AACA,YAAIZ,eAAe,GAAGF,cAAc,CAACE,eAAf,KAAmCF,cAAc,CAACE,eAAf,GAAiCV,aAAa,EAAjF,CAAtB,CAH2D,CAGiD;;AAE5GU,QAAAA,eAAe,CAACqE,GAAhB,CAAoB1E,aAAa,CAACO,GAAlC,EAAuC;AACrC0B,UAAAA,mBAAmB,EAAEuC,cADgB;AAErCvD,UAAAA,KAAK,EAAEjB,aAF8B;AAGrCC,UAAAA,QAAQ,EAAE;AAH2B,SAAvC;AAKD,OAVG,CAAJ;AAWD,KAhBD,EARuF,CAwBnF;AACJ;;AAEAC,IAAAA,iBAAiB,CAACT,IAAlB,CAAuB,UAAUU,cAAV,EAA0B;AAC/C,UAAIe,UAAU,GAAGf,cAAc,CAACe,UAAhC;AACA,UAAIyD,WAAJ;AACA,UAAItE,eAAe,GAAGF,cAAc,CAACE,eAArC;;AAEA,UAAIA,eAAJ,EAAqB;AACnB,YAAIuE,UAAU,GAAGvE,eAAe,CAACK,IAAhB,GAAuB,CAAvB,CAAjB;;AAEA,YAAIkE,UAAU,IAAI,IAAlB,EAAwB;AACtBD,UAAAA,WAAW,GAAGtE,eAAe,CAACC,GAAhB,CAAoBsE,UAApB,CAAd;AACD;AACF;;AAED,UAAI,CAACD,WAAL,EAAkB;AAChB3D,QAAAA,qBAAqB,CAACd,iBAAD,EAAoBC,cAApB,CAArB;AACA;AACD;;AAED,UAAI0E,gBAAgB,GAAG5B,qBAAqB,CAAC5C,eAAD,CAA5C;AACAa,MAAAA,UAAU,CAAC4D,MAAX,CAAkBD,gBAAgB,CAAC3B,WAAnC,EAAgD2B,gBAAgB,CAACrB,GAAjE;AACAtC,MAAAA,UAAU,CAAC6D,iBAAX,CAA6B5E,cAAc,CAACmB,aAA5C;AACA/B,MAAAA,YAAY,CAACyF,cAAb,CAA4B7E,cAA5B,EAA4C,gBAA5C,EAA8DwE,WAAW,CAAC1D,KAAZ,CAAkBX,GAAlB,CAAsB,UAAtB,EAAkC,IAAlC,CAA9D,EAAuG,SAAvG;AACD,KAtBD;AAuBD,GAlDD;AAmDD","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// Only create one roam controller for each coordinate system.\n// one roam controller might be refered by two inside data zoom\n// components (for example, one for x and one for y). When user\n// pan or zoom, only dispatch one action for those data zoom\n// components.\nimport RoamController from '../../component/helper/RoamController';\nimport * as throttleUtil from '../../util/throttle';\nimport { makeInner } from '../../util/model';\nimport { each, curry, createHashMap } from 'zrender/lib/core/util';\nimport { collectReferCoordSysModelInfo } from './helper';\nvar inner = makeInner();\nexport function setViewInfoToCoordSysRecord(api, dataZoomModel, getRange) {\n  inner(api).coordSysRecordMap.each(function (coordSysRecord) {\n    var dzInfo = coordSysRecord.dataZoomInfoMap.get(dataZoomModel.uid);\n\n    if (dzInfo) {\n      dzInfo.getRange = getRange;\n    }\n  });\n}\nexport function disposeCoordSysRecordIfNeeded(api, dataZoomModel) {\n  var coordSysRecordMap = inner(api).coordSysRecordMap;\n  var coordSysKeyArr = coordSysRecordMap.keys();\n\n  for (var i = 0; i < coordSysKeyArr.length; i++) {\n    var coordSysKey = coordSysKeyArr[i];\n    var coordSysRecord = coordSysRecordMap.get(coordSysKey);\n    var dataZoomInfoMap = coordSysRecord.dataZoomInfoMap;\n\n    if (dataZoomInfoMap) {\n      var dzUid = dataZoomModel.uid;\n      var dzInfo = dataZoomInfoMap.get(dzUid);\n\n      if (dzInfo) {\n        dataZoomInfoMap.removeKey(dzUid);\n\n        if (!dataZoomInfoMap.keys().length) {\n          disposeCoordSysRecord(coordSysRecordMap, coordSysRecord);\n        }\n      }\n    }\n  }\n}\n\nfunction disposeCoordSysRecord(coordSysRecordMap, coordSysRecord) {\n  if (coordSysRecord) {\n    coordSysRecordMap.removeKey(coordSysRecord.model.uid);\n    var controller = coordSysRecord.controller;\n    controller && controller.dispose();\n  }\n}\n\nfunction createCoordSysRecord(api, coordSysModel) {\n  // These init props will never change after record created.\n  var coordSysRecord = {\n    model: coordSysModel,\n    containsPoint: curry(containsPoint, coordSysModel),\n    dispatchAction: curry(dispatchAction, api),\n    dataZoomInfoMap: null,\n    controller: null\n  }; // Must not do anything depends on coordSysRecord outside the event handler here,\n  // because coordSysRecord not completed yet.\n\n  var controller = coordSysRecord.controller = new RoamController(api.getZr());\n  each(['pan', 'zoom', 'scrollMove'], function (eventName) {\n    controller.on(eventName, function (event) {\n      var batch = [];\n      coordSysRecord.dataZoomInfoMap.each(function (dzInfo) {\n        // Check whether the behaviors (zoomOnMouseWheel, moveOnMouseMove,\n        // moveOnMouseWheel, ...) enabled.\n        if (!event.isAvailableBehavior(dzInfo.model.option)) {\n          return;\n        }\n\n        var method = (dzInfo.getRange || {})[eventName];\n        var range = method && method(dzInfo.dzReferCoordSysInfo, coordSysRecord.model.mainType, coordSysRecord.controller, event);\n        !dzInfo.model.get('disabled', true) && range && batch.push({\n          dataZoomId: dzInfo.model.id,\n          start: range[0],\n          end: range[1]\n        });\n      });\n      batch.length && coordSysRecord.dispatchAction(batch);\n    });\n  });\n  return coordSysRecord;\n}\n/**\n * This action will be throttled.\n */\n\n\nfunction dispatchAction(api, batch) {\n  api.dispatchAction({\n    type: 'dataZoom',\n    animation: {\n      easing: 'cubicOut',\n      duration: 100\n    },\n    batch: batch\n  });\n}\n\nfunction containsPoint(coordSysModel, e, x, y) {\n  return coordSysModel.coordinateSystem.containPoint([x, y]);\n}\n/**\n * Merge roamController settings when multiple dataZooms share one roamController.\n */\n\n\nfunction mergeControllerParams(dataZoomInfoMap) {\n  var controlType; // DO NOT use reserved word (true, false, undefined) as key literally. Even if encapsulated\n  // as string, it is probably revert to reserved word by compress tool. See #7411.\n\n  var prefix = 'type_';\n  var typePriority = {\n    'type_true': 2,\n    'type_move': 1,\n    'type_false': 0,\n    'type_undefined': -1\n  };\n  var preventDefaultMouseMove = true;\n  dataZoomInfoMap.each(function (dataZoomInfo) {\n    var dataZoomModel = dataZoomInfo.model;\n    var oneType = dataZoomModel.get('disabled', true) ? false : dataZoomModel.get('zoomLock', true) ? 'move' : true;\n\n    if (typePriority[prefix + oneType] > typePriority[prefix + controlType]) {\n      controlType = oneType;\n    } // Prevent default move event by default. If one false, do not prevent. Otherwise\n    // users may be confused why it does not work when multiple insideZooms exist.\n\n\n    preventDefaultMouseMove = preventDefaultMouseMove && dataZoomModel.get('preventDefaultMouseMove', true);\n  });\n  return {\n    controlType: controlType,\n    opt: {\n      // RoamController will enable all of these functionalities,\n      // and the final behavior is determined by its event listener\n      // provided by each inside zoom.\n      zoomOnMouseWheel: true,\n      moveOnMouseMove: true,\n      moveOnMouseWheel: true,\n      preventDefaultMouseMove: !!preventDefaultMouseMove\n    }\n  };\n}\n\nexport function installDataZoomRoamProcessor(registers) {\n  registers.registerProcessor(registers.PRIORITY.PROCESSOR.FILTER, function (ecModel, api) {\n    var apiInner = inner(api);\n    var coordSysRecordMap = apiInner.coordSysRecordMap || (apiInner.coordSysRecordMap = createHashMap());\n    coordSysRecordMap.each(function (coordSysRecord) {\n      // `coordSysRecordMap` always exists (becuase it hold the `roam controller`, which should\n      // better not re-create each time), but clear `dataZoomInfoMap` each round of the workflow.\n      coordSysRecord.dataZoomInfoMap = null;\n    });\n    ecModel.eachComponent({\n      mainType: 'dataZoom',\n      subType: 'inside'\n    }, function (dataZoomModel) {\n      var dzReferCoordSysWrap = collectReferCoordSysModelInfo(dataZoomModel);\n      each(dzReferCoordSysWrap.infoList, function (dzCoordSysInfo) {\n        var coordSysUid = dzCoordSysInfo.model.uid;\n        var coordSysRecord = coordSysRecordMap.get(coordSysUid) || coordSysRecordMap.set(coordSysUid, createCoordSysRecord(api, dzCoordSysInfo.model));\n        var dataZoomInfoMap = coordSysRecord.dataZoomInfoMap || (coordSysRecord.dataZoomInfoMap = createHashMap()); // Notice these props might be changed each time for a single dataZoomModel.\n\n        dataZoomInfoMap.set(dataZoomModel.uid, {\n          dzReferCoordSysInfo: dzCoordSysInfo,\n          model: dataZoomModel,\n          getRange: null\n        });\n      });\n    }); // (1) Merge dataZoom settings for each coord sys and set to the roam controller.\n    // (2) Clear coord sys if not refered by any dataZoom.\n\n    coordSysRecordMap.each(function (coordSysRecord) {\n      var controller = coordSysRecord.controller;\n      var firstDzInfo;\n      var dataZoomInfoMap = coordSysRecord.dataZoomInfoMap;\n\n      if (dataZoomInfoMap) {\n        var firstDzKey = dataZoomInfoMap.keys()[0];\n\n        if (firstDzKey != null) {\n          firstDzInfo = dataZoomInfoMap.get(firstDzKey);\n        }\n      }\n\n      if (!firstDzInfo) {\n        disposeCoordSysRecord(coordSysRecordMap, coordSysRecord);\n        return;\n      }\n\n      var controllerParams = mergeControllerParams(dataZoomInfoMap);\n      controller.enable(controllerParams.controlType, controllerParams.opt);\n      controller.setPointerChecker(coordSysRecord.containsPoint);\n      throttleUtil.createOrUpdate(coordSysRecord, 'dispatchAction', firstDzInfo.model.get('throttle', true), 'fixRate');\n    });\n  });\n}"]},"metadata":{},"sourceType":"module"}