{"ast":null,"code":"import { createElement } from '../core';\nimport * as zrUtil from '../../core/util';\nimport Path from '../../graphic/Path';\nimport ZRImage from '../../graphic/Image';\nimport TSpan from '../../graphic/TSpan';\nimport { path as svgPath, image as svgImage, text as svgText } from '../graphic';\nvar MARK_UNUSED = '0';\nvar MARK_USED = '1';\n\nvar Definable = function () {\n  function Definable(zrId, svgRoot, tagNames, markLabel, domName) {\n    this.nextId = 0;\n    this._domName = '_dom';\n    this.createElement = createElement;\n    this._zrId = zrId;\n    this._svgRoot = svgRoot;\n    this._tagNames = typeof tagNames === 'string' ? [tagNames] : tagNames;\n    this._markLabel = markLabel;\n\n    if (domName) {\n      this._domName = domName;\n    }\n  }\n\n  Definable.prototype.getDefs = function (isForceCreating) {\n    var svgRoot = this._svgRoot;\n\n    var defs = this._svgRoot.getElementsByTagName('defs');\n\n    if (defs.length === 0) {\n      if (isForceCreating) {\n        var defs_1 = svgRoot.insertBefore(this.createElement('defs'), svgRoot.firstChild);\n\n        if (!defs_1.contains) {\n          defs_1.contains = function (el) {\n            var children = defs_1.children;\n\n            if (!children) {\n              return false;\n            }\n\n            for (var i = children.length - 1; i >= 0; --i) {\n              if (children[i] === el) {\n                return true;\n              }\n            }\n\n            return false;\n          };\n        }\n\n        return defs_1;\n      } else {\n        return null;\n      }\n    } else {\n      return defs[0];\n    }\n  };\n\n  Definable.prototype.doUpdate = function (target, onUpdate) {\n    if (!target) {\n      return;\n    }\n\n    var defs = this.getDefs(false);\n\n    if (target[this._domName] && defs.contains(target[this._domName])) {\n      if (typeof onUpdate === 'function') {\n        onUpdate(target);\n      }\n    } else {\n      var dom = this.add(target);\n\n      if (dom) {\n        target[this._domName] = dom;\n      }\n    }\n  };\n\n  Definable.prototype.add = function (target) {\n    return null;\n  };\n\n  Definable.prototype.addDom = function (dom) {\n    var defs = this.getDefs(true);\n\n    if (dom.parentNode !== defs) {\n      defs.appendChild(dom);\n    }\n  };\n\n  Definable.prototype.removeDom = function (target) {\n    var defs = this.getDefs(false);\n\n    if (defs && target[this._domName]) {\n      defs.removeChild(target[this._domName]);\n      target[this._domName] = null;\n    }\n  };\n\n  Definable.prototype.getDoms = function () {\n    var defs = this.getDefs(false);\n\n    if (!defs) {\n      return [];\n    }\n\n    var doms = [];\n    zrUtil.each(this._tagNames, function (tagName) {\n      var tags = defs.getElementsByTagName(tagName);\n\n      for (var i = 0; i < tags.length; i++) {\n        doms.push(tags[i]);\n      }\n    });\n    return doms;\n  };\n\n  Definable.prototype.markAllUnused = function () {\n    var doms = this.getDoms();\n    var that = this;\n    zrUtil.each(doms, function (dom) {\n      dom[that._markLabel] = MARK_UNUSED;\n    });\n  };\n\n  Definable.prototype.markDomUsed = function (dom) {\n    dom && (dom[this._markLabel] = MARK_USED);\n  };\n\n  ;\n\n  Definable.prototype.markDomUnused = function (dom) {\n    dom && (dom[this._markLabel] = MARK_UNUSED);\n  };\n\n  ;\n\n  Definable.prototype.isDomUnused = function (dom) {\n    return dom && dom[this._markLabel] !== MARK_USED;\n  };\n\n  Definable.prototype.removeUnused = function () {\n    var _this = this;\n\n    var defs = this.getDefs(false);\n\n    if (!defs) {\n      return;\n    }\n\n    var doms = this.getDoms();\n    zrUtil.each(doms, function (dom) {\n      if (_this.isDomUnused(dom)) {\n        defs.removeChild(dom);\n      }\n    });\n  };\n\n  Definable.prototype.getSvgProxy = function (displayable) {\n    if (displayable instanceof Path) {\n      return svgPath;\n    } else if (displayable instanceof ZRImage) {\n      return svgImage;\n    } else if (displayable instanceof TSpan) {\n      return svgText;\n    } else {\n      return svgPath;\n    }\n  };\n\n  Definable.prototype.getSvgElement = function (displayable) {\n    return displayable.__svgEl;\n  };\n\n  return Definable;\n}();\n\nexport default Definable;","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/zrender/lib/svg/helper/Definable.js"],"names":["createElement","zrUtil","Path","ZRImage","TSpan","path","svgPath","image","svgImage","text","svgText","MARK_UNUSED","MARK_USED","Definable","zrId","svgRoot","tagNames","markLabel","domName","nextId","_domName","_zrId","_svgRoot","_tagNames","_markLabel","prototype","getDefs","isForceCreating","defs","getElementsByTagName","length","defs_1","insertBefore","firstChild","contains","el","children","i","doUpdate","target","onUpdate","dom","add","addDom","parentNode","appendChild","removeDom","removeChild","getDoms","doms","each","tagName","tags","push","markAllUnused","that","markDomUsed","markDomUnused","isDomUnused","removeUnused","_this","getSvgProxy","displayable","getSvgElement","__svgEl"],"mappings":"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","sourcesContent":["import { createElement } from '../core';\nimport * as zrUtil from '../../core/util';\nimport Path from '../../graphic/Path';\nimport ZRImage from '../../graphic/Image';\nimport TSpan from '../../graphic/TSpan';\nimport { path as svgPath, image as svgImage, text as svgText } from '../graphic';\nvar MARK_UNUSED = '0';\nvar MARK_USED = '1';\nvar Definable = (function () {\n    function Definable(zrId, svgRoot, tagNames, markLabel, domName) {\n        this.nextId = 0;\n        this._domName = '_dom';\n        this.createElement = createElement;\n        this._zrId = zrId;\n        this._svgRoot = svgRoot;\n        this._tagNames = typeof tagNames === 'string' ? [tagNames] : tagNames;\n        this._markLabel = markLabel;\n        if (domName) {\n            this._domName = domName;\n        }\n    }\n    Definable.prototype.getDefs = function (isForceCreating) {\n        var svgRoot = this._svgRoot;\n        var defs = this._svgRoot.getElementsByTagName('defs');\n        if (defs.length === 0) {\n            if (isForceCreating) {\n                var defs_1 = svgRoot.insertBefore(this.createElement('defs'), svgRoot.firstChild);\n                if (!defs_1.contains) {\n                    defs_1.contains = function (el) {\n                        var children = defs_1.children;\n                        if (!children) {\n                            return false;\n                        }\n                        for (var i = children.length - 1; i >= 0; --i) {\n                            if (children[i] === el) {\n                                return true;\n                            }\n                        }\n                        return false;\n                    };\n                }\n                return defs_1;\n            }\n            else {\n                return null;\n            }\n        }\n        else {\n            return defs[0];\n        }\n    };\n    Definable.prototype.doUpdate = function (target, onUpdate) {\n        if (!target) {\n            return;\n        }\n        var defs = this.getDefs(false);\n        if (target[this._domName] && defs.contains(target[this._domName])) {\n            if (typeof onUpdate === 'function') {\n                onUpdate(target);\n            }\n        }\n        else {\n            var dom = this.add(target);\n            if (dom) {\n                target[this._domName] = dom;\n            }\n        }\n    };\n    Definable.prototype.add = function (target) {\n        return null;\n    };\n    Definable.prototype.addDom = function (dom) {\n        var defs = this.getDefs(true);\n        if (dom.parentNode !== defs) {\n            defs.appendChild(dom);\n        }\n    };\n    Definable.prototype.removeDom = function (target) {\n        var defs = this.getDefs(false);\n        if (defs && target[this._domName]) {\n            defs.removeChild(target[this._domName]);\n            target[this._domName] = null;\n        }\n    };\n    Definable.prototype.getDoms = function () {\n        var defs = this.getDefs(false);\n        if (!defs) {\n            return [];\n        }\n        var doms = [];\n        zrUtil.each(this._tagNames, function (tagName) {\n            var tags = defs.getElementsByTagName(tagName);\n            for (var i = 0; i < tags.length; i++) {\n                doms.push(tags[i]);\n            }\n        });\n        return doms;\n    };\n    Definable.prototype.markAllUnused = function () {\n        var doms = this.getDoms();\n        var that = this;\n        zrUtil.each(doms, function (dom) {\n            dom[that._markLabel] = MARK_UNUSED;\n        });\n    };\n    Definable.prototype.markDomUsed = function (dom) {\n        dom && (dom[this._markLabel] = MARK_USED);\n    };\n    ;\n    Definable.prototype.markDomUnused = function (dom) {\n        dom && (dom[this._markLabel] = MARK_UNUSED);\n    };\n    ;\n    Definable.prototype.isDomUnused = function (dom) {\n        return dom && dom[this._markLabel] !== MARK_USED;\n    };\n    Definable.prototype.removeUnused = function () {\n        var _this = this;\n        var defs = this.getDefs(false);\n        if (!defs) {\n            return;\n        }\n        var doms = this.getDoms();\n        zrUtil.each(doms, function (dom) {\n            if (_this.isDomUnused(dom)) {\n                defs.removeChild(dom);\n            }\n        });\n    };\n    Definable.prototype.getSvgProxy = function (displayable) {\n        if (displayable instanceof Path) {\n            return svgPath;\n        }\n        else if (displayable instanceof ZRImage) {\n            return svgImage;\n        }\n        else if (displayable instanceof TSpan) {\n            return svgText;\n        }\n        else {\n            return svgPath;\n        }\n    };\n    Definable.prototype.getSvgElement = function (displayable) {\n        return displayable.__svgEl;\n    };\n    return Definable;\n}());\nexport default Definable;\n"]},"metadata":{},"sourceType":"module"}