{"ast":null,"code":"import { __extends } from \"tslib\";\nimport Definable from './Definable';\nimport * as zrUtil from '../../core/util';\nimport { createOrUpdateImage } from '../../graphic/helper/image';\nimport WeakMap from '../../core/WeakMap';\n\nfunction isPattern(value) {\n  return value && (!!value.image || !!value.svgElement);\n}\n\nvar patternDomMap = new WeakMap();\n\nvar PatternManager = function (_super) {\n  __extends(PatternManager, _super);\n\n  function PatternManager(zrId, svgRoot) {\n    return _super.call(this, zrId, svgRoot, ['pattern'], '__pattern_in_use__') || this;\n  }\n\n  PatternManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n    if (displayable && displayable.style) {\n      var that_1 = this;\n      zrUtil.each(['fill', 'stroke'], function (fillOrStroke) {\n        var pattern = displayable.style[fillOrStroke];\n\n        if (isPattern(pattern)) {\n          var defs = that_1.getDefs(true);\n          var dom = patternDomMap.get(pattern);\n\n          if (dom) {\n            if (!defs.contains(dom)) {\n              that_1.addDom(dom);\n            }\n          } else {\n            dom = that_1.add(pattern);\n          }\n\n          that_1.markUsed(displayable);\n          var id = dom.getAttribute('id');\n          svgElement.setAttribute(fillOrStroke, 'url(#' + id + ')');\n        }\n      });\n    }\n  };\n\n  PatternManager.prototype.add = function (pattern) {\n    if (!isPattern(pattern)) {\n      return;\n    }\n\n    var dom = this.createElement('pattern');\n    pattern.id = pattern.id == null ? this.nextId++ : pattern.id;\n    dom.setAttribute('id', 'zr' + this._zrId + '-pattern-' + pattern.id);\n    dom.setAttribute('x', '0');\n    dom.setAttribute('y', '0');\n    dom.setAttribute('patternUnits', 'userSpaceOnUse');\n    this.updateDom(pattern, dom);\n    this.addDom(dom);\n    return dom;\n  };\n\n  PatternManager.prototype.update = function (pattern) {\n    if (!isPattern(pattern)) {\n      return;\n    }\n\n    var that = this;\n    this.doUpdate(pattern, function () {\n      var dom = patternDomMap.get(pattern);\n      that.updateDom(pattern, dom);\n    });\n  };\n\n  PatternManager.prototype.updateDom = function (pattern, patternDom) {\n    var svgElement = pattern.svgElement;\n\n    if (svgElement instanceof SVGElement) {\n      if (svgElement.parentNode !== patternDom) {\n        patternDom.innerHTML = '';\n        patternDom.appendChild(svgElement);\n        patternDom.setAttribute('width', pattern.svgWidth + '');\n        patternDom.setAttribute('height', pattern.svgHeight + '');\n      }\n    } else {\n      var img = void 0;\n      var prevImage = patternDom.getElementsByTagName('image');\n\n      if (prevImage.length) {\n        if (pattern.image) {\n          img = prevImage[0];\n        } else {\n          patternDom.removeChild(prevImage[0]);\n          return;\n        }\n      } else if (pattern.image) {\n        img = this.createElement('image');\n      }\n\n      if (img) {\n        var imageSrc = void 0;\n        var patternImage = pattern.image;\n\n        if (typeof patternImage === 'string') {\n          imageSrc = patternImage;\n        } else if (patternImage instanceof HTMLImageElement) {\n          imageSrc = patternImage.src;\n        } else if (patternImage instanceof HTMLCanvasElement) {\n          imageSrc = patternImage.toDataURL();\n        }\n\n        if (imageSrc) {\n          img.setAttribute('href', imageSrc);\n          img.setAttribute('x', '0');\n          img.setAttribute('y', '0');\n          var hostEl = {\n            dirty: function () {}\n          };\n          var createdImage = createOrUpdateImage(imageSrc, img, hostEl, function (img) {\n            patternDom.setAttribute('width', img.width + '');\n            patternDom.setAttribute('height', img.height + '');\n          });\n\n          if (createdImage && createdImage.width && createdImage.height) {\n            patternDom.setAttribute('width', createdImage.width + '');\n            patternDom.setAttribute('height', createdImage.height + '');\n          }\n\n          patternDom.appendChild(img);\n        }\n      }\n    }\n\n    var x = pattern.x || 0;\n    var y = pattern.y || 0;\n    var rotation = (pattern.rotation || 0) / Math.PI * 180;\n    var scaleX = pattern.scaleX || 1;\n    var scaleY = pattern.scaleY || 1;\n    var transform = \"translate(\" + x + \", \" + y + \") rotate(\" + rotation + \") scale(\" + scaleX + \", \" + scaleY + \")\";\n    patternDom.setAttribute('patternTransform', transform);\n    patternDomMap.set(pattern, patternDom);\n  };\n\n  PatternManager.prototype.markUsed = function (displayable) {\n    if (displayable.style) {\n      if (isPattern(displayable.style.fill)) {\n        _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.fill));\n      }\n\n      if (isPattern(displayable.style.stroke)) {\n        _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.stroke));\n      }\n    }\n  };\n\n  return PatternManager;\n}(Definable);\n\nexport default PatternManager;","map":{"version":3,"sources":["D:/桌面/react基础原理分析/react_extension/node_modules/zrender/lib/svg/helper/PatternManager.js"],"names":["__extends","Definable","zrUtil","createOrUpdateImage","WeakMap","isPattern","value","image","svgElement","patternDomMap","PatternManager","_super","zrId","svgRoot","call","prototype","addWithoutUpdate","displayable","style","that_1","each","fillOrStroke","pattern","defs","getDefs","dom","get","contains","addDom","add","markUsed","id","getAttribute","setAttribute","createElement","nextId","_zrId","updateDom","update","that","doUpdate","patternDom","SVGElement","parentNode","innerHTML","appendChild","svgWidth","svgHeight","img","prevImage","getElementsByTagName","length","removeChild","imageSrc","patternImage","HTMLImageElement","src","HTMLCanvasElement","toDataURL","hostEl","dirty","createdImage","width","height","x","y","rotation","Math","PI","scaleX","scaleY","transform","set","fill","markDomUsed","stroke"],"mappings":"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","sourcesContent":["import { __extends } from \"tslib\";\nimport Definable from './Definable';\nimport * as zrUtil from '../../core/util';\nimport { createOrUpdateImage } from '../../graphic/helper/image';\nimport WeakMap from '../../core/WeakMap';\nfunction isPattern(value) {\n    return value && (!!value.image || !!value.svgElement);\n}\nvar patternDomMap = new WeakMap();\nvar PatternManager = (function (_super) {\n    __extends(PatternManager, _super);\n    function PatternManager(zrId, svgRoot) {\n        return _super.call(this, zrId, svgRoot, ['pattern'], '__pattern_in_use__') || this;\n    }\n    PatternManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n        if (displayable && displayable.style) {\n            var that_1 = this;\n            zrUtil.each(['fill', 'stroke'], function (fillOrStroke) {\n                var pattern = displayable.style[fillOrStroke];\n                if (isPattern(pattern)) {\n                    var defs = that_1.getDefs(true);\n                    var dom = patternDomMap.get(pattern);\n                    if (dom) {\n                        if (!defs.contains(dom)) {\n                            that_1.addDom(dom);\n                        }\n                    }\n                    else {\n                        dom = that_1.add(pattern);\n                    }\n                    that_1.markUsed(displayable);\n                    var id = dom.getAttribute('id');\n                    svgElement.setAttribute(fillOrStroke, 'url(#' + id + ')');\n                }\n            });\n        }\n    };\n    PatternManager.prototype.add = function (pattern) {\n        if (!isPattern(pattern)) {\n            return;\n        }\n        var dom = this.createElement('pattern');\n        pattern.id = pattern.id == null ? this.nextId++ : pattern.id;\n        dom.setAttribute('id', 'zr' + this._zrId\n            + '-pattern-' + pattern.id);\n        dom.setAttribute('x', '0');\n        dom.setAttribute('y', '0');\n        dom.setAttribute('patternUnits', 'userSpaceOnUse');\n        this.updateDom(pattern, dom);\n        this.addDom(dom);\n        return dom;\n    };\n    PatternManager.prototype.update = function (pattern) {\n        if (!isPattern(pattern)) {\n            return;\n        }\n        var that = this;\n        this.doUpdate(pattern, function () {\n            var dom = patternDomMap.get(pattern);\n            that.updateDom(pattern, dom);\n        });\n    };\n    PatternManager.prototype.updateDom = function (pattern, patternDom) {\n        var svgElement = pattern.svgElement;\n        if (svgElement instanceof SVGElement) {\n            if (svgElement.parentNode !== patternDom) {\n                patternDom.innerHTML = '';\n                patternDom.appendChild(svgElement);\n                patternDom.setAttribute('width', pattern.svgWidth + '');\n                patternDom.setAttribute('height', pattern.svgHeight + '');\n            }\n        }\n        else {\n            var img = void 0;\n            var prevImage = patternDom.getElementsByTagName('image');\n            if (prevImage.length) {\n                if (pattern.image) {\n                    img = prevImage[0];\n                }\n                else {\n                    patternDom.removeChild(prevImage[0]);\n                    return;\n                }\n            }\n            else if (pattern.image) {\n                img = this.createElement('image');\n            }\n            if (img) {\n                var imageSrc = void 0;\n                var patternImage = pattern.image;\n                if (typeof patternImage === 'string') {\n                    imageSrc = patternImage;\n                }\n                else if (patternImage instanceof HTMLImageElement) {\n                    imageSrc = patternImage.src;\n                }\n                else if (patternImage instanceof HTMLCanvasElement) {\n                    imageSrc = patternImage.toDataURL();\n                }\n                if (imageSrc) {\n                    img.setAttribute('href', imageSrc);\n                    img.setAttribute('x', '0');\n                    img.setAttribute('y', '0');\n                    var hostEl = {\n                        dirty: function () { }\n                    };\n                    var createdImage = createOrUpdateImage(imageSrc, img, hostEl, function (img) {\n                        patternDom.setAttribute('width', img.width + '');\n                        patternDom.setAttribute('height', img.height + '');\n                    });\n                    if (createdImage && createdImage.width && createdImage.height) {\n                        patternDom.setAttribute('width', createdImage.width + '');\n                        patternDom.setAttribute('height', createdImage.height + '');\n                    }\n                    patternDom.appendChild(img);\n                }\n            }\n        }\n        var x = pattern.x || 0;\n        var y = pattern.y || 0;\n        var rotation = (pattern.rotation || 0) / Math.PI * 180;\n        var scaleX = pattern.scaleX || 1;\n        var scaleY = pattern.scaleY || 1;\n        var transform = \"translate(\" + x + \", \" + y + \") rotate(\" + rotation + \") scale(\" + scaleX + \", \" + scaleY + \")\";\n        patternDom.setAttribute('patternTransform', transform);\n        patternDomMap.set(pattern, patternDom);\n    };\n    PatternManager.prototype.markUsed = function (displayable) {\n        if (displayable.style) {\n            if (isPattern(displayable.style.fill)) {\n                _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.fill));\n            }\n            if (isPattern(displayable.style.stroke)) {\n                _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.stroke));\n            }\n        }\n    };\n    return PatternManager;\n}(Definable));\nexport default PatternManager;\n"]},"metadata":{},"sourceType":"module"}